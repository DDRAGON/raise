function addUpdateTableInfoListener(e){socket.on("tableInfo",e)}function addUpdatePasswordListener(e){socket.on("passWord",e)}function emitUpdatePlayerName(e,i,a){socket.emit("updatePlayerName",{seatId:e,name:i,passWord:a})}function emitChangeAssistantMode(e){socket.emit("changeAssistantMode",e)}function emitUpdateAssistantPassword(e){socket.emit("updateAssistantPassword",e)}function emitImageSendWithPassWord(e,i){socket.emit("imageSendWithPassWord",{image:e,passWord:i})}function redrawCamera(e,i,a,o,t,s,n,d){config.ctxForVideo.drawImage(video,e,i,a,o,t,s,n,d)}function setDefaultSize(){canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.canvasWidth=DEFAULT_CANVAS_WIDTH,config.canvasHeight=DEFAULT_CANVAS_HEIGHT,config.videoSourceX=parseInt((videoWidth-config.canvasWidth)/2),config.videoSourceY=parseInt((videoHeight-config.canvasHeight)/2),config.videoSourceWidth=DEFAULT_CANVAS_WIDTH,config.videoSourceHeight=DEFAULT_CANVAS_HEIGHT,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=DEFAULT_CANVAS_WIDTH,config.videoDisplayHeight=DEFAULT_CANVAS_HEIGHT,0>config.videoSourceX&&(config.videoSourceX=0,config.videoSourceWidth=videoWidth,config.videoDisplayX=Math.abs(config.videoSourceX),config.videoDisplayWidth=videoWidth),0>config.videoSourceY&&(config.videoSourceY=0,config.videoSourceHeight=videoHeight,config.videoDisplayY=Math.abs(config.videoSourceY),config.videoDisplayHeight=videoHeight),config.adjustToWindowResize=!1,config.isFullScreenMode=!1,config.isFullScreen169Mode=!1,$("#settings").show(),$(".navbar-wrapper").show(),$("#footer_contents").show(),displayUpdate()}function setCameraSize(){canvasForVideo.width=videoWidth,canvasForVideo.height=videoHeight,config.canvasWidth=videoWidth,config.canvasHeight=videoHeight,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=videoWidth,config.videoSourceHeight=videoHeight,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=videoWidth,config.videoDisplayHeight=videoHeight,displayUpdate()}function fullScreenMode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!0,config.isFullScreen169Mode=!1,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen(),$("#escKeyAdvice").show().fadeOut(5e3)}function fullScreen169Mode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!1,config.isFullScreen169Mode=!0,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen169(),$("#escKeyAdvice").show().fadeOut(5e3)}function setSizeToFullScreen(){var e=$(window).width(),i=$(window).height();canvasForVideo.width=e,canvasForVideo.height=i,config.canvasWidth=e,config.canvasHeight=i,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=i,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=i,displayUpdate()}function setSizeToFullScreen169(){var e=$(window).width(),i=Number(9*e/16);canvasForVideo.width=e,canvasForVideo.height=i,config.canvasWidth=e,config.canvasHeight=i,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=i,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=i,displayUpdate()}function displayUpdate(){$("#canvas_pane").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvasForVideo").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvas").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$(".centerAdvice").css({width:4*config.canvasWidth/5+"px","margin-left":4*-config.canvasWidth/5/2+"px"}),setLayoutRound(),"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)}function drawTableInfo(e){var i=e.players,a=e.board;displayInit(),displayDealerButton(e.button),displayBoard(a);for(var o in i){var t=i[o];t&&(isActive(t)&&resetPlayerBox(t.seatId),displayName(t.seatId,t.name),displayHand(t.seatId,t.hand,t.isActive),displayOdds(t.seatId,t.win,t.tie),lastTableInfo.players&&lastTableInfo.players[o]&&isActive(lastTableInfo.players[o])&&!isActive(t)&&displayFold(t.seatId))}calculateOddsStyle(),updateInputPlayerNames(i),lastTableInfo=e}function displayInit(){$(".playerBox").hide(),$("#board").hide(),$("#caption").trigger("keyup"),$("#description").trigger("keyup"),$(".actionBox").removeClass("actionF actionC actionR actionA "),$(".chipBox").removeClass("actionF actionC actionR actionA "),$(".btn_action").removeClass("active"),$(".chipBox").text(""),$(".chip_form").children().val("")}function resetPlayerBox(e){$("#player"+e+"Folded").hide(),$("#player"+e+"Box").css({opacity:"1.0"})}function isActive(e){return 1==e.isActive}function displayDealerButton(e){$(".dealer").removeClass("on"),$("#player"+e+"Dealer").addClass("on")}function displayBoard(e){if(!e||0>=e.length)$(".board").fadeOut(200,function(){$(".board.card").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")});else{$("#board").show();for(var i=0;5>i;i++)if(e[i]){var a=e[i];$selector=$("#board"+i),$selector.fadeIn(),$selector.text(a.charAt(0)),$selector.addClass("color_"+a.charAt(1)),$selector.addClass("mark_"+a.charAt(1))}else $("#board"+i).hide()}}function displayHand(e,i,a){$leftCard=$("#player"+e+"HandLeft"),$rightCard=$("#player"+e+"HandRight"),i&&i[0]?a?displayCard($leftCard,i[0]):semitransparentDisplayCard($leftCard,i[0]):hideCard($leftCard),i&&i[1]?a?displayCard($rightCard,i[1]):semitransparentDisplayCard($rightCard,i[1]):hideCard($rightCard)}function hideCard(e){e.hide(),e.removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")}function displayCard(e,i){e.text(i.charAt(0)),e.addClass("color_"+i.charAt(1)),e.addClass("mark_"+i.charAt(1)),e.css({opacity:1}),e.fadeIn()}function semitransparentDisplayCard(e){e.css({opacity:.4})}function displayName(e,i){i&&($("#player"+e+"Box").show(),$("#player"+e+"Name").text(i))}function displayFold(e){$("#player"+e+"Folded").show().textillate({"in":{effect:"swing"},callback:function(){$("#player"+e+"Box").stop().animate({opacity:"0.5"},600)}}).textillate("start")}function displayOdds(e,i,a){var o=$("#player"+e+"Odds");if(i){var t=Number(i.replace("%",""));a&&(t+=Number(a.replace("%",""))),t=Math.round(t),oddsList.push(t),o.attr("data-win",t).text(t+"%").show()}else o.hide()}function calculateOddsStyle(){var e=$(".odds");e.removeClass("max win");var i=Math.max.apply(null,oddsList);$(".odds[data-win='"+i+"']").addClass("max"),$(".odds[data-win='100']").addClass("win"),oddsList=[]}function updateInputPlayerNames(e){for(var i=0;10>i;i++)if(e[i]){var a=e[i];$("#inputPlayer"+i).val(a.name)}else $("#inputPlayer"+i).val("")}function disConnected(){alert("接続が切れました！\nリロードし再度設定してください。")}function setPassword(e){$("#room_id").attr("value",e)}function setLayoutRound(){var e=Number(config.canvasWidth),i=Number(config.canvasHeight),a=parseInt(10*i/DEFAULT_CANVAS_HEIGHT),o=parseInt(16*i/DEFAULT_CANVAS_HEIGHT),t=parseInt(12*i/DEFAULT_CANVAS_HEIGHT),s=parseInt(67*e/DEFAULT_CANVAS_WIDTH),n=parseInt(18*e/DEFAULT_CANVAS_WIDTH),d=parseInt(20*i/DEFAULT_CANVAS_WIDTH),c=parseInt(5*i/DEFAULT_CANVAS_HEIGHT);parseInt(10*i/DEFAULT_CANVAS_HEIGHT);var r=parseInt(30*i/DEFAULT_CANVAS_HEIGHT),l=n+s+8,p=parseInt(66*i/DEFAULT_CANVAS_HEIGHT);$("#canvas_pane").css({width:e+"px",height:i+"px"});var h=parseInt(210*i/DEFAULT_CANVAS_HEIGHT),g=parseInt(203*e/DEFAULT_CANVAS_WIDTH),f=parseInt(39*e/DEFAULT_CANVAS_WIDTH),v=parseInt(48*e/DEFAULT_CANVAS_WIDTH);$("#board").css({top:h+"px",left:g+"px"}),$("#board0").css({width:f+"px",height:v+"px",font:o+"pt Arial, sans-serif"}),$("#board1").css({width:f+"px",height:v+"px",font:o+"pt Arial, sans-serif"}),$("#board2").css({width:f+"px",height:v+"px",font:o+"pt Arial, sans-serif"}),$("#board3").css({width:f+"px",height:v+"px",font:o+"pt Arial, sans-serif"}),$("#board4").css({width:f+"px",height:v+"px",font:o+"pt Arial, sans-serif"}),$("#player0Box").css({left:"0px",top:i/2-p/2+"px",width:l+"px",height:p+"px"}),$("#player1Box").css({left:"0px",top:"0px",width:l+"px",height:p+"px"}),$("#player2Box").css({left:1*(e/3)-l/2+"px",top:"0px",width:l+"px",height:p+"px"}),$("#player3Box").css({left:2*(e/3)-l/2+"px",top:"0px",width:l+"px",height:p+"px"}),$("#player4Box").css({left:e-l+"px",top:"0px",width:l+"px",height:p+"px"}),$("#player5Box").css({left:e-l+"px",top:i/2-p/2+"px",width:l+"px",height:p+"px"}),$("#player6Box").css({left:e-l+"px",top:i-p+"px",width:l+"px",height:p+"px"}),$("#player7Box").css({left:2*(e/3)-l/2+"px",top:i-p+"px",width:l+"px",height:p+"px"}),$("#player8Box").css({left:1*(e/3)-l/2+"px",top:i-p+"px",width:l+"px",height:p+"px"}),$("#player9Box").css({left:"0px",top:i-p+"px",width:l+"px",height:p+"px"});for(var u=0;10>u;u++)$("#player"+u+"Hand").css({height:r+"px"}),$("#player"+u+"HandLeft").css({"padding-top":c+"px",font:o+"pt Arial, sans-serif"}),$("#player"+u+"HandRight").css({"padding-top":c+"px",font:o+"pt Arial, sans-serif"}),$("#player"+u+"Name").css({width:s+"px"}),$("#player"+u+"Dealer").css({width:n+"px","font-size":a+"pt"}),$("#player"+u+"Box").css({"font-size":a+"pt"}),$("#player"+u+"Odds").css({"font-size":a+"pt"}),$("#player"+u+"Folded").css({"font-size":t+"pt","padding-left":d+"px","padding-left":"-5px"})}function changePlayerName(e){var i=$("#inputPlayer"+e).val();emitUpdatePlayerName(e,i,$("#assistant_id").val())}function deletePlayer(e){$("#inputPlayer"+e).val(""),emitUpdatePlayerName(e,"",$("#assistant_id").val())}function changeChip(e){var i=$("#inputChip"+e).val();$("#player"+e+"Chip").text(i)}function changeAction(e,i){$(".player"+e+".btn_action").removeClass("active"),$("#inputAction"+i+e).addClass("active");var a=$("#player"+e+"Action"),o=$("#player"+e+"Chip");o.removeClass("actionF actionC actionR actionA "),o.addClass("action"+i),a.removeClass("actionF actionC actionR actionA "),a.addClass("action"+i),a.text(i),"A"==i?($("#inputChip"+e).val("All In"),$("#player"+e+"Chip").text("All In")):($("#inputChip"+e).val(""),$("#player"+e+"Chip").text("")),$("#inputChip"+e).focus()}function onClickProgression(e){$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active"),$("a#"+e).addClass("active")}function onClickMark(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("color_s color_h color_d color_c"),$("a#"+e).addClass("active"),$("a.card_selector.rank").addClass("color_"+e)}function onClickRank(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a#"+e).addClass("active")}function sendImage(e){emitImageSendWithPassWord(e,$("#assistant_id").val()),$("#message").html("send "+e),this.mark="",this.rank="　",showBalloon(e)}function onClickSend(){var e=$(".card_selector.progression.active").attr("id");if(e)sendImage(e);else{var i=$(".card_selector.mark.active").attr("id"),a=$(".card_selector.rank.active").attr("id");if(!(i&&a&&(i+"").match(markRegExp)&&(a+"").match(rankRegExp)))return;sendImage(a+i)}$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active")}function showBalloon(e){var i="send ";i+=2==e.length?e[0]:e,$("#send").showBalloon({contents:i,position:"right",showDuration:100,maxLifetime:3e3,hideDuration:500,classname:"send_balloon",css:{color:"#FFF",backgroundColor:"#4e5d6c",border:"solid 1px #2e3d4c",boxShadow:"2px 2px 2px #999"}}),$(".send_balloon").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c"),2==e.length&&$(".send_balloon").addClass("send_balloon mark_"+e[1]+" color_"+e[1])}var socket=io.connect("http://"+hostAddress+"/oddsSystem");socket.on("disconnect",function(){disConnected()}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null,videoWidth,videoHeight;navigator.getUserMedia({video:!0,audio:!1},function(e){video.src=window.URL.createObjectURL(e),video.addEventListener("loadeddata",function(){videoWidth=video.videoWidth,videoHeight=video.videoHeight,console.log("videoWidth = "+videoWidth+", videoHeight = "+videoHeight),setDefaultSize()},!1)},function(e){console.log(e)});var DEFAULT_CANVAS_WIDTH=640,DEFAULT_CANVAS_HEIGHT=360,KEY_CODE_ESC=27,canvasForVideo,config={canvasWidth:DEFAULT_CANVAS_WIDTH,canvasHeight:DEFAULT_CANVAS_HEIGHT,background:"camera",videoSourceX:0,videoSourceY:0,videoSourceWidth:DEFAULT_CANVAS_WIDTH,videoSourceHeight:DEFAULT_CANVAS_HEIGHT,videoDisplayX:0,videoDisplayY:0,videoDisplayWidth:DEFAULT_CANVAS_WIDTH,videoDisplayHeight:DEFAULT_CANVAS_HEIGHT,adjustToWindowResize:!1,isFullScreenMode:!1,isFullScreen169Mode:!1};$("#changeScreenSize").change(function(){switch($(this).val()){case"defaultSize":setDefaultSize();break;case"camera":setCameraSize();break;case"fullScreen":fullScreenMode();break;case"16:9_fullScreen":fullScreen169Mode()}setLayoutRound()}),$("#changeBackground").change(function(){config.background=$(this).val(),"RGB(255,255,0)"===config.background?$("#canvas_pane").attr("class","wall_yellow"):$("#canvas_pane").attr("class","wall_"+config.background)}),setInterval(function(){config.ctxForVideo&&"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)},50),$(window).resize(function(){return config.adjustToWindowResize!==!1?config.isFullScreenMode===!0?(setSizeToFullScreen(),void 0):(config.isFullScreen169Mode===!0&&setSizeToFullScreen169(),void 0):void 0}),$(window).keydown(function(e){config.adjustToWindowResize===!0&&e.keyCode===KEY_CODE_ESC&&setDefaultSize()}),$(function(){$(".container").css({width:"auto","padding-left":"0px","padding-right":"0px"}),canvasForVideo=$("#canvasForVideo").get(0),canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.ctxForVideo=canvasForVideo.getContext("2d")});var lastTableInfo={},oddsList=[];addUpdateTableInfoListener(drawTableInfo),addUpdatePasswordListener(setPassword),$(function(){setLayoutRound(),$(".selectpicker").selectpicker({selectedText:"cat"}),$(".selectpicker.btn").addClass("btn-sm"),$(".draggable").draggable({containment:"#canvas_pane"}),$(".playerList.0").addClass("stripe_a"),$(".playerList.1").addClass("stripe_b"),$("#showAdditionalForm").on("click",function(){$(".actionBox").toggle(),$(".chipBox").toggle(),$(".action_form").toggle(),$(".chip_form").toggle(),setLayoutRound()}),$("#howto_header").on("click",function(){$("#howto_items").collapse("toggle")}),$("#direction_header").on("click",function(){$("#direction_items").collapse("toggle")}),$("#player_header").on("click",function(){$("#player_items").collapse("toggle")}),$("#config_header").on("click",function(){$("#config_items").collapse("toggle")}),$("#card_selector_toggle").on("click",function(){$("#card_selector").slideToggle()}),$("#assistant_id").on("focusout",function(){var e=$(this).val();e?(emitChangeAssistantMode("Assistant"),emitUpdateAssistantPassword($("#assistant_id").val())):(emitChangeAssistantMode("Original"),emitUpdateAssistantPassword(""))}),$("#caption").on("keyup",function(){var e=$("#captionBox");e.text($(this).val()),e.text().length>0?e.show():e.hide()}),$("#description").on("keyup",function(){var e=$("#descriptionBox");e.text($(this).val()),e.text().length>0?e.show():e.hide()}),$("#layoutSetDefault").on("click",function(){setLayoutRound()}),$("#layoutShow").on("click",function(){$("#captionBox").show(),$("#descriptionBox").show(),$(".board").show(),$(".playerBox").show()})});var markRegExp=/[shdc]/,rankRegExp=/[2-9TJQKA]/,cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];