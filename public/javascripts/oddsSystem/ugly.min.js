function markClick(o){this.mark=o,drawImage()}function numClick(o){this.num=o,drawImage()}function sendImage(o){if(socket.emit("imageSend",o),sound(),$("#message").html("send "+o),this.mark="",this.num="　",drawImage(),drawSentImage(o),"start"==o)for(var n=0;10>n;n++)$("#inputPlayer"+n).val("")}function sendCard(){return"s"!=this.mark&&"h"!=this.mark&&"d"!=this.mark&&"c"!=this.mark?($("#message").html("mark is invalid!"),void 0):"2"!=this.num&&"3"!=this.num&&"4"!=this.num&&"5"!=this.num&&"6"!=this.num&&"7"!=this.num&&"8"!=this.num&&"9"!=this.num&&"T"!=this.num&&"J"!=this.num&&"Q"!=this.num&&"K"!=this.num&&"A"!=this.num?($("#message").html("number is invalid!"),void 0):(sendImage(this.num+this.mark),void 0)}function drawImage(){switch(this.mark){case"s":$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"♠</span>");break;case"h":$("#image").html('<span style="color:#ff0000;font-size:64px;">'+this.num+"♥</span>");break;case"d":$("#image").html('<span style="color:#0000ff;font-size:64px;">'+this.num+"♦</span>");break;case"c":$("#image").html('<span style="color:#00bb00;font-size:64px;">'+this.num+"♣</span>");break;default:$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"</span>")}}function drawSentImage(o){switch(o[1]){case"s":$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+o[0]+"♠</span>");break;case"h":$("#sentImage").html('<span style="color:#ff0000;font-size:64px;">'+o[0]+"♥</span>");break;case"d":$("#sentImage").html('<span style="color:#0000ff;font-size:64px;">'+o[0]+"♦</span>");break;case"c":$("#sentImage").html('<span style="color:#00bb00;font-size:64px;">'+o[0]+"♣</span>");break;default:$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+o[0]+"</span>")}}function keyDown(){var o=$("#inputArea").val().toUpperCase()+String.fromCharCode(event.keyCode).toLowerCase();if(1==easyMode){var n=cardsForEasyMode.indexOf(o);if(n>=0)return sendImage(cards[n]),setTimeout(function(){$("#inputArea").val("")},100),void 0;"g"==o&&(sound(),setTimeout(function(){$("#inputArea").val("")},100))}else cards.indexOf(o)>=0&&(sendImage(o),setTimeout(function(){$("#inputArea").val("")},100))}function keyUpPlayer(o){var n=$("#inputPlayer"+o).val();socket.emit("updatePlayerName",{seatId:o,name:n})}function deletePlayer(o){$("#inputPlayer"+o).val(""),socket.emit("updatePlayerName",{seatId:o,name:""})}function moveDealerButton(){socket.emit("moveDealerButton",{})}function sound(){var o="";o+="<EMBED id = 'id_sound'",o+=" SRC=/music/cursor6.wav",o+=" AUTOSTART='true'",o+=" HIDDEN='true'>",document.getElementById("id_sound").innerHTML=o}function drawBackGround(){config.ctx.clearRect(0,0,config.canvasWidth,config.canvasHeight)}function drawBox(o){var n=Math.floor(o/5)*(config.canvasWidth-config.boxWidth),i=Math.floor(o%5)*config.displayHeight+config.displayCardHeight,t=Math.floor(config.boxHeight/2);setColorAndFont("black",0),config.ctx.fillRect(n,i,config.boxWidth,t),setColorAndFont("white",0),i+=t,config.ctx.fillRect(n,i,config.boxWidth,t)}function drawDealerButton(o){var n=Math.floor(config.boxHeight/2),i=Math.floor(o/5)*(config.canvasWidth-config.boxWidth),t=Math.floor(o%5)*config.displayHeight+config.displayCardHeight+n;5>o?i+=config.boxWidth+n:i-=n,setColorAndFont("white",0),config.ctx.beginPath(),config.ctx.arc(i,t,n,0,2*Math.PI,!1),config.ctx.fill(),setColorAndFont("green",config.fontSize+5),i-=n/2,t+=n/2,config.ctx.fillText("D",i,t)}function drawPlayerHands(o,n){var i=Math.floor(o/5)*(config.canvasWidth-config.boxWidth),t=Math.floor(o%5)*config.displayHeight;n&&n[0]&&drawCard(n[0],i,t),n&&n[1]&&(i+=config.displayCardWidth,drawCard(n[1],i,t))}function drawPlayerWinperAndName(o,n,i,t,a){setColorAndFont("white",config.fontSize);var e=Math.floor(o/5)*(config.canvasWidth-config.boxWidth)+3,c=Math.floor(o%5)*config.displayHeight+config.displayCardHeight+config.fontSize-2;if(t&&config.ctx.fillText(t,e,c),c+=config.fontSize,void 0!==a){if(setColorAndFont("black",config.fontSize),0==a)return config.ctx.fillText("Fold",e,c),void 0;if(n){var d=Math.round(10*Number(n.slice(0,-1)))/10,r=d+"％";if(i){var s=Math.round(10*Number(i.slice(0,-1)))/10;s>=5&&(r+="("+s+"％)",setColorAndFont("black",config.tieFontSize))}config.ctx.fillText(r,e,c)}}}function drawBoard(o){setColorAndFont("green",0);var n=Number(config.canvasWidth/2)-Number(config.boardWidth/2),i=config.canvasHeight-config.boardHeight;config.ctx.fillRect(n,i,config.boardWidth,config.boardHeight),n+=config.boardWidthSpace,i+=config.boardHeightSpace;for(var t in o){var a=o[t];drawCard(a,n,i),n+=config.displayCardWidth}}function drawCard(o,n,i){switch(setColorAndFont("white",0),config.ctx.fillRect(n,i,2*config.cardFontSize-11,config.cardFontSize),drawX=n+2,drawY=i+config.cardFontSize-3,o.charAt(1)){case"s":return setColorAndFont("black",config.cardFontSize),config.ctx.fillText(o.charAt(0),drawX,drawY),setColorAndFont("black",config.markFontSize),config.ctx.fillText("♠",drawX+config.markAdjust,drawY),void 0;case"c":return setColorAndFont("green",config.cardFontSize),config.ctx.fillText(o.charAt(0),drawX,drawY),setColorAndFont("green",config.markFontSize),config.ctx.fillText("♣",drawX+config.markAdjust,drawY),void 0;case"d":return setColorAndFont("blue",config.cardFontSize),config.ctx.fillText(o.charAt(0),drawX,drawY),setColorAndFont("blue",config.markFontSize),config.ctx.fillText("♦",drawX+config.markAdjust,drawY),void 0;case"h":return setColorAndFont("red",config.cardFontSize),config.ctx.fillText(o.charAt(0),drawX,drawY),setColorAndFont("red",config.markFontSize),config.ctx.fillText("♥",drawX+config.markAdjust,drawY),void 0}}function setColorAndFont(o,n){config.ctx.fillStyle=o,config.ctx.font="bold "+n+"px 'ITC HIGHLANDER'"}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null;navigator.getUserMedia({video:!0,audio:!1},function(o){video.src=window.URL.createObjectURL(o)},function(o){console.log(o)});var socket=io.connect("http://"+hostAddress+"/oddsSystem"),easyMode=!1,mark="",num="　",passWord="",backgroundColor="camera",config={canvasWidth:640,canvasHeight:360,originalCardWidth:48,originalCardHeight:64,displayCardWidth:36,displayCardHeight:48,space:8,boardWidthSpace:6,boardHeightSpace:6,cardFontSize:30,markFontSize:30,markAdjust:20};config.displayCardWidth=2*config.cardFontSize-11,config.displayCardHeight=config.cardFontSize,config.displayWidth=2*config.displayCardWidth,config.displayHeight=Number(config.canvasHeight/5),config.boxWidth=config.displayWidth,config.boxHeight=config.displayHeight-config.displayCardHeight-config.space,config.boardWidth=5*config.displayCardWidth+2*config.boardWidthSpace,config.boardHeight=config.cardFontSize+2*config.boardHeightSpace,config.fontSize=Number(config.boxHeight/2),config.tieFontSize=config.fontSize-4;var cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];$("#changeInputMode").change(function(){switch($(this).val()){case"easy":easyMode=!0;break;case"normal":easyMode=!1;break;case"qrCode":return document.getElementById("inputArea").innerHTML=passWord,void 0}document.getElementById("inputArea").innerHTML='<input type="text" onkeydown="keyDown();" id="inputArea" class="form-control">'}),$("#changeBackground").change(function(){backgroundColor=$(this).val()}),$(function(){var o=$("#canvasForVideo").get(0),n=$("#canvas").get(0);config.ctxForVideo=o.getContext("2d"),config.ctx=n.getContext("2d")}),socket.on("tableInfo",function(o){var n=o.players,i=o.board;drawBackGround();for(var t in n){var a=n[t];a&&(drawBox(a.seatId),1==a.isActive&&drawPlayerHands(a.seatId,a.hand),drawPlayerWinperAndName(a.seatId,a.win,a.tie,a.name,a.isActive),i&&i.length>0&&drawBoard(i))}drawDealerButton(o.button)}),socket.on("passWord",function(o){passWord=o}),setInterval(function(){return"camera"===backgroundColor?(config.ctxForVideo.drawImage(video,0,0,config.canvasWidth,config.canvasHeight),void 0):(config.ctxForVideo.fillStyle=backgroundColor,config.ctxForVideo.fillRect(0,0,config.canvasWidth,config.canvasHeight),void 0)},50);