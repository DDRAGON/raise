function addUpdateTableInfoListener(a){socket.on("tableInfo",a)}function addUpdatePasswordListener(a){socket.on("passWord",a)}function emitUpdatePlayerName(a,e,t){socket.emit("updatePlayerName",{seatId:a,name:e,passWord:t})}function emitChangeAssistantMode(a){socket.emit("changeAssistantMode",a)}function emitUpdateAssistantPassword(a){socket.emit("updateAssistantPassword",a)}function emitImageSendWithPassWord(a,e){socket.emit("imageSendWithPassWord",{image:a,passWord:e})}function setDefaultSize(){config.canvasWidth=DEFAULT_CANVAS_WIDTH,config.canvasHeight=DEFAULT_CANVAS_HEIGHT,canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,videoCutWidth=parseInt((videoWidth-config.canvasWidth)/2),videoCutHeight=parseInt((videoHeight-config.canvasHeight)/2),0>videoCutWidth&&(flameWidth=Math.abs(videoCutWidth),videoCutWidth=0),0>videoCutHeight&&(flameHeight=Math.abs(videoCutHeight),videoCutHeight=0)}function setCameraSize(){config.canvasWidth=videoWidth,config.canvasHeight=videoHeight,canvasForVideo.width=videoWidth,canvasForVideo.height=videoHeight,flameWidth=0,flameHeight=0,videoCutWidth=0,videoCutHeight=0}function drawTableInfo(a){var e=a.players,t=a.board;displayInit(),displayDealerButton(a.button),displayBoard(t);for(var o in e){var i=e[o];i&&(isActive(i)&&resetPlayerBox(i.seatId),displayName(i.seatId,i.name),displayHand(i.seatId,i.hand,i.isActive),displayOdds(i.seatId,i.win,i.tie),lastTableInfo.players&&lastTableInfo.players[o]&&isActive(lastTableInfo.players[o])&&!isActive(i)&&displayFold(i.seatId))}calculateOddsStyle(),updateInputPlayerNames(e),lastTableInfo=a}function displayInit(){$(".playerBox").hide(),$("#caption").trigger("keyup"),$("#description").trigger("keyup"),$(".actionBox").removeClass("actionF actionC actionR actionA "),$(".chipBox").removeClass("actionF actionC actionR actionA "),$(".btn_action").removeClass("active"),$(".chipBox").text(""),$(".chip_form").children().val("")}function resetPlayerBox(a){$("#player"+a+"Folded").hide(),$("#player"+a+"Box").css({opacity:"1.0"})}function isActive(a){return 1==a.isActive}function displayDealerButton(a){$(".dealer").removeClass("on"),$("#player"+a+"Dealer").addClass("on")}function displayBoard(a){if(!a||0>=a.length)$(".board").fadeOut(200,function(){$(".board.card").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")});else{$("#board").show();for(var e in a){var t=a[e];$selector=$("#board"+e),$selector.fadeIn(),$selector.text(t.charAt(0)),$selector.addClass("color_"+t.charAt(1)),$selector.addClass("mark_"+t.charAt(1))}}}function displayHand(a,e,t){return $leftCard=$("#player"+a+"HandLeft"),$rightCard=$("#player"+a+"HandRight"),t?(e&&e[0]?displayCard($leftCard,e[0]):hideCard($leftCard),e&&e[1]?displayCard($rightCard,e[1]):hideCard($rightCard),void 0):(hideCard($leftCard),hideCard($rightCard),void 0)}function hideCard(a){a.hide(),a.removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")}function displayCard(a,e){a.text(e.charAt(0)),a.addClass("color_"+e.charAt(1)),a.addClass("mark_"+e.charAt(1)),a.fadeIn()}function displayName(a,e){e&&($("#player"+a+"Box").show(),$("#player"+a+"Name").text(e))}function displayFold(a){$("#player"+a+"Folded").show().textillate({"in":{effect:"swing"},callback:function(){$("#player"+a+"Box").stop().animate({opacity:"0.5"},600)}}).textillate("start")}function displayOdds(a,e,t){var o=$("#player"+a+"Odds");if(e){var i=createWinOdds(e),s=createTieOdds(t);s?o.addClass("withTie"):o.removeClass("withTie"),oddsList.push(i),o.attr("data-win",i).text(i+s+"%").show()}else o.hide()}function createWinOdds(a){return roundOdds(a)}function createTieOdds(a){var e=roundOdds(a);return 5>e?"":"("+e+")"}function roundOdds(a){return a?Math.round(10*Number(a.replace("%","")))/10:void 0}function calculateOddsStyle(){var a=$(".odds");a.removeClass("max win");var e=Math.max.apply(null,oddsList);$(".odds[data-win='"+e+"']").addClass("max"),$(".odds[data-win='100']").addClass("win"),oddsList=[]}function updateInputPlayerNames(a){for(var e=0;10>e;e++)if(a[e]){var t=a[e];$("#inputPlayer"+e).val(t.name)}else $("#inputPlayer"+e).val("")}function setPassword(a){$("#room_id").attr("value",a)}function setLayoutRound(){var a=Number($("#canvas").attr("width")),e=Number($("#canvas").attr("height")),t=Number($("#player0Box").css("width").replace("px","")),o=Number($("#player0Box").css("height").replace("px",""));$("#player0Box").css({left:"0px",top:e/2-o/2+"px"}),$("#player1Box").css({left:"0px",top:"0px"}),$("#player2Box").css({left:1*(a/3)-t/2+"px",top:"0px"}),$("#player3Box").css({left:2*(a/3)-t/2+"px",top:"0px"}),$("#player4Box").css({left:a-t+"px",top:"0px"}),$("#player5Box").css({left:a-t+"px",top:e/2-o/2+"px"}),$("#player6Box").css({left:a-t+"px",top:e-o+"px"}),$("#player7Box").css({left:2*(a/3)-t/2+"px",top:e-o+"px"}),$("#player8Box").css({left:1*(a/3)-t/2+"px",top:e-o+"px"}),$("#player9Box").css({left:"0px",top:e-o+"px"})}function changePlayerName(a){var e=$("#inputPlayer"+a).val();emitUpdatePlayerName(a,e,$("#assistant_id").val())}function deletePlayer(a){$("#inputPlayer"+a).val(""),emitUpdatePlayerName(a,"",$("#assistant_id").val())}function changeChip(a){var e=$("#inputChip"+a).val();$("#player"+a+"Chip").text(e)}function changeAction(a,e){$(".player"+a+".btn_action").removeClass("active"),$("#inputAction"+e+a).addClass("active");var t=$("#player"+a+"Action"),o=$("#player"+a+"Chip");o.removeClass("actionF actionC actionR actionA "),o.addClass("action"+e),t.removeClass("actionF actionC actionR actionA "),t.addClass("action"+e),t.text(e),"A"==e?($("#inputChip"+a).val("All In"),$("#player"+a+"Chip").text("All In")):($("#inputChip"+a).val(""),$("#player"+a+"Chip").text("")),$("#inputChip"+a).focus()}function onClickProgression(a){$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active"),$("a#"+a).addClass("active")}function onClickMark(a){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("color_s color_h color_d color_c"),$("a#"+a).addClass("active"),$("a.card_selector.rank").addClass("color_"+a)}function onClickRank(a){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a#"+a).addClass("active")}function sendImage(a){emitImageSendWithPassWord(a,$("#assistant_id").val()),$("#message").html("send "+a),this.mark="",this.rank="ã€€",showBalloon(a)}function onClickSend(){var a=$(".card_selector.progression.active").attr("id");if(a)sendImage(a);else{var e=$(".card_selector.mark.active").attr("id"),t=$(".card_selector.rank.active").attr("id");if(!(e&&t&&(e+"").match(markRegExp)&&(t+"").match(rankRegExp)))return;sendImage(t+e)}$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active")}function showBalloon(a){var e="send ";e+=2==a.length?a[0]:a,$("#send").showBalloon({contents:e,position:"right",showDuration:100,maxLifetime:3e3,hideDuration:500,classname:"send_balloon",css:{color:"#FFF",backgroundColor:"#4e5d6c",border:"solid 1px #2e3d4c",boxShadow:"2px 2px 2px #999"}}),$(".send_balloon").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c"),2==a.length&&$(".send_balloon").addClass("send_balloon mark_"+a[1]+" color_"+a[1])}var socket=io.connect("http://"+hostAddress+"/oddsSystem");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null,videoWidth,videoHeight;navigator.getUserMedia({video:!0,audio:!1},function(a){video.src=window.URL.createObjectURL(a),video.addEventListener("loadeddata",function(){videoWidth=video.videoWidth,videoHeight=video.videoHeight,console.log("videoWidth = "+videoWidth+", videoHeight = "+videoHeight),setDefaultSize()},!1)},function(a){console.log(a)});var DEFAULT_CANVAS_WIDTH=640,DEFAULT_CANVAS_HEIGHT=360,canvasForVideo,background="camera",videoCutWidth=0,videoCutHeight=0,flameWidth=0,flameHeight=0,config={canvasWidth:DEFAULT_CANVAS_WIDTH,canvasHeight:DEFAULT_CANVAS_HEIGHT};$("#changeScreenSize").change(function(){switch($(this).val()){case"defaultSize":setDefaultSize();break;case"camera":setCameraSize()}}),$("#changeBackground").change(function(){background=$(this).val(),$("#canvas_pane").attr("class","wall_"+background)}),setInterval(function(){return config.ctxForVideo?"camera"===background?(config.ctxForVideo.drawImage(video,videoCutWidth,videoCutHeight,config.canvasWidth,config.canvasHeight,flameWidth,flameHeight,config.canvasWidth,config.canvasHeight),void 0):void 0:void 0},50),$(function(){canvasForVideo=$("#canvasForVideo").get(0),canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.ctxForVideo=canvasForVideo.getContext("2d")});var lastTableInfo={},oddsList=[];addUpdateTableInfoListener(drawTableInfo),addUpdatePasswordListener(setPassword),$(function(){setLayoutRound(),$(".selectpicker").selectpicker({selectedText:"cat"}),$(".selectpicker.btn").addClass("btn-sm"),$(".draggable").draggable({containment:"#canvas_pane"}),$(".playerList.0").addClass("stripe_a"),$(".playerList.1").addClass("stripe_b"),$("#showAdditionalForm").on("click",function(){$(".actionBox").toggle(),$(".chipBox").toggle(),$(".action_form").toggle(),$(".chip_form").toggle(),setLayoutRound()}),$("#howto_header").on("click",function(){$("#howto_items").collapse("toggle")}),$("#direction_header").on("click",function(){$("#direction_items").collapse("toggle")}),$("#player_header").on("click",function(){$("#player_items").collapse("toggle")}),$("#config_header").on("click",function(){$("#config_items").collapse("toggle")}),$("#card_selector_toggle").on("click",function(){$("#card_selector").slideToggle()}),$("#assistant_id").on("focusout",function(){var a=$(this).val();a?(emitChangeAssistantMode("Assistant"),emitUpdateAssistantPassword($("#assistant_id").val())):(emitChangeAssistantMode("Original"),emitUpdateAssistantPassword(""))}),$("#caption").on("keyup",function(){var a=$("#captionBox");a.text($(this).val()),a.text().length>0?a.show():a.hide()}),$("#description").on("keyup",function(){var a=$("#descriptionBox");a.text($(this).val()),a.text().length>0?a.show():a.hide()}),$("#layoutSetDefault").on("click",function(){setLayoutRound()}),$("#layoutShow").on("click",function(){$("#captionBox").show(),$("#descriptionBox").show(),$(".board").show(),$(".playerBox").show()})});var markRegExp=/[shdc]/,rankRegExp=/[2-9TJQKA]/,cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];