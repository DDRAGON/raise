function addUpdateTableInfoListener(e){socket.on("tableInfo",e)}function addUpdatePasswordListener(e){socket.on("passWord",e)}function emitUpdatePlayerName(e,o,a){socket.emit("updatePlayerName",{seatId:e,name:o,passWord:a})}function emitChangeAssistantMode(e){socket.emit("changeAssistantMode",e)}function emitUpdateAssistantPassword(e){socket.emit("updateAssistantPassword",e)}function emitImageSendWithPassWord(e,o){socket.emit("imageSendWithPassWord",{image:e,passWord:o})}function emitCaptionMessage(e,o){socket.emit("updateCaptionMessage",{captionMessage:e,passWord:o})}function emitDescriptionMessage(e,o){socket.emit("updateDescriptionMessage",{descriptionMessage:e,passWord:o})}function emitChipUpdate(e,o,a){socket.emit("updateChipMany",{seatId:e,chipMany:o,passWord:a})}function redrawCamera(e,o,a,i,t,s,n,c){config.ctxForVideo.drawImage(video,e,o,a,i,t,s,n,c)}function setDefaultSize(){canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.canvasWidth=DEFAULT_CANVAS_WIDTH,config.canvasHeight=DEFAULT_CANVAS_HEIGHT,config.videoSourceX=parseInt((videoWidth-config.canvasWidth)/2),config.videoSourceY=parseInt((videoHeight-config.canvasHeight)/2),config.videoSourceWidth=DEFAULT_CANVAS_WIDTH,config.videoSourceHeight=DEFAULT_CANVAS_HEIGHT,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=DEFAULT_CANVAS_WIDTH,config.videoDisplayHeight=DEFAULT_CANVAS_HEIGHT,0>config.videoSourceX&&(config.videoSourceX=0,config.videoSourceWidth=videoWidth,config.videoDisplayX=Math.abs(config.videoSourceX),config.videoDisplayWidth=videoWidth),0>config.videoSourceY&&(config.videoSourceY=0,config.videoSourceHeight=videoHeight,config.videoDisplayY=Math.abs(config.videoSourceY),config.videoDisplayHeight=videoHeight),config.adjustToWindowResize=!1,config.isFullScreenMode=!1,config.isFullScreen169Mode=!1,$("#settings").show(),$(".navbar-wrapper").show(),$("#footer_contents").show(),displayUpdate()}function setCameraSize(){canvasForVideo.width=videoWidth,canvasForVideo.height=videoHeight,config.canvasWidth=videoWidth,config.canvasHeight=videoHeight,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=videoWidth,config.videoSourceHeight=videoHeight,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=videoWidth,config.videoDisplayHeight=videoHeight,displayUpdate()}function fullScreenMode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!0,config.isFullScreen169Mode=!1,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen(),$("#escKeyAdvice").show().fadeOut(5e3)}function fullScreen169Mode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!1,config.isFullScreen169Mode=!0,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen169(),$("#escKeyAdvice").show().fadeOut(5e3)}function setSizeToFullScreen(){var e=$(window).width(),o=$(window).height();canvasForVideo.width=e,canvasForVideo.height=o,config.canvasWidth=e,config.canvasHeight=o,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=o,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=o,displayUpdate()}function setSizeToFullScreen169(){var e=$(window).width(),o=Number(9*e/16);canvasForVideo.width=e,canvasForVideo.height=o,config.canvasWidth=e,config.canvasHeight=o,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=o,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=o,displayUpdate()}function displayUpdate(){$("#canvas_pane").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvasForVideo").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvas").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$(".centerAdvice").css({width:4*config.canvasWidth/5+"px","margin-left":4*-config.canvasWidth/5/2+"px"}),setLayoutRound(),"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)}function drawTableInfo(e){var o=e.players,a=e.board,i=e.captionMessage,t=e.descriptionMessage;displayInit(),displayDealerButton(e.button),displayBoard(a);for(var s in o){var n=o[s];n&&(isActive(n)&&resetPlayerBox(n.seatId),displayName(n.seatId,n.name),displayHand(n.seatId,n.hand,n.isActive),displayOdds(n.seatId,n.win,n.tie),1==config.isDisplayChipBox&&displayChipMany(n.seatId,n.chipMany),lastTableInfo.players&&lastTableInfo.players[s]&&isActive(lastTableInfo.players[s])&&!isActive(n)&&displayFold(n.seatId))}calculateOddsStyle(),updateInputPlayerNames(o),updateCaptionMessage(i),updateDescriptionMessage(t),lastTableInfo=e}function hideTable(){$(".board.card").removeClass("color_s color_h color_d color_c color_s_for_blue_background color_h_for_blue_background color_d_for_blue_background color_c_for_blue_background color_s_for_green_background color_h_for_green_background color_d_for_green_background color_c_for_green_background mark_s mark_h mark_d mark_c").text("");for(var e=0;10>e;e++)$leftCard=$("#player"+e+"HandLeft"),hideCard($leftCard),$rightCard=$("#player"+e+"HandRight"),hideCard($rightCard)}function displayInit(){$(".playerBox").hide(),$("#board").hide()}function resetPlayerBox(e){$("#player"+e+"Folded").hide(),$("#player"+e+"Box").css({opacity:"1.0"})}function isActive(e){return 1==e.isActive}function displayDealerButton(e){$(".dealer").removeClass("on"),$("#player"+e+"Dealer").addClass("on")}function displayBoard(e){if(!e||0>=e.length)$(".board").fadeOut(200,function(){$(".board.card").removeClass("color_s color_h color_d color_c color_s_for_blue_background color_h_for_blue_background color_d_for_blue_background color_c_for_blue_background color_s_for_green_background color_h_for_green_background color_d_for_green_background color_c_for_green_background mark_s mark_h mark_d mark_c").text("")});else{$("#board").show();for(var o=0;5>o;o++)if(e[o]){var a=e[o];switch($selector=$("#board"+o),$selector.fadeIn(),$selector.text(a.charAt(0)),config.colorPattern){case"1":$selector.addClass("color_"+a.charAt(1));break;case"2":$selector.addClass("color_"+a.charAt(1)+"_for_blue_background");break;case"3":$selector.addClass("color_"+a.charAt(1)+"_for_green_background")}$selector.addClass("mark_"+a.charAt(1))}else $("#board"+o).hide()}}function displayHand(e,o,a){$leftCard=$("#player"+e+"HandLeft"),$rightCard=$("#player"+e+"HandRight"),o&&o[0]?a?displayCard($leftCard,o[0]):semitransparentDisplayCard($leftCard,o[0]):hideCard($leftCard),o&&o[1]?a?displayCard($rightCard,o[1]):semitransparentDisplayCard($rightCard,o[1]):hideCard($rightCard)}function hideCard(e){e.hide(),e.removeClass("color_s color_h color_d color_c color_s_for_blue_background color_h_for_blue_background color_d_for_blue_background color_c_for_blue_background color_s_for_green_background color_h_for_green_background color_d_for_green_background color_c_for_green_background mark_s mark_h mark_d mark_c").text("")}function displayCard(e,o){switch(e.text(o.charAt(0)),config.colorPattern){case"1":e.addClass("color_"+o.charAt(1));break;case"2":e.addClass("color_"+o.charAt(1)+"_for_blue_background");break;case"3":e.addClass("color_"+o.charAt(1)+"_for_green_background")}e.addClass("mark_"+o.charAt(1)),e.css({opacity:1}),e.fadeIn()}function semitransparentDisplayCard(e){e.css({opacity:.4})}function displayName(e,o){o&&($("#player"+e+"Box").show(),$("#player"+e+"Name").text(o))}function displayFold(e){$("#player"+e+"Folded").show().textillate({"in":{effect:"swing"},callback:function(){$("#player"+e+"Box").stop().animate({opacity:"0.8"},600)}}).textillate("start")}function displayOdds(e,o,a){var i=$("#player"+e+"Odds");if(o){var t=Number(o.replace("%",""));a&&(t+=Number(a.replace("%",""))),t=Math.round(t),oddsList.push(t),i.attr("data-win",t).text(t+"%").show()}else i.hide()}function displayChipMany(e,o){$("#player"+e+"Chip").text(o)}function calculateOddsStyle(){var e=$(".odds");e.removeClass("max win");var o=Math.max.apply(null,oddsList);$(".odds[data-win='"+o+"']").addClass("max"),$(".odds[data-win='100']").addClass("win"),oddsList=[]}function updateInputPlayerNames(e){for(var o=0;10>o;o++)if(e[o]){var a=e[o];$("#inputPlayer"+o).val(a.name)}else $("#inputPlayer"+o).val("")}function updateCaptionMessage(e){var o=$("#captionBox");o.text(e),o.text().length>0?o.show():o.hide()}function updateDescriptionMessage(e){var o=$("#descriptionBox");o.text(e),o.text().length>0?o.show():o.hide()}function disConnected(){alert("接続が切れました！\nリロードし再度設定してください。")}function setPassword(e){$("#room_id").attr("value",e)}function setLayoutRound(){var e=Number(config.canvasWidth),o=Number(config.canvasHeight),a=parseInt(10*o/DEFAULT_CANVAS_HEIGHT),i=parseInt(16*o/DEFAULT_CANVAS_HEIGHT),t=parseInt(12*o/DEFAULT_CANVAS_HEIGHT),s=parseInt(67*e/DEFAULT_CANVAS_WIDTH),n=parseInt(18*e/DEFAULT_CANVAS_WIDTH),c=parseInt(20*o/DEFAULT_CANVAS_WIDTH),d=parseInt(5*o/DEFAULT_CANVAS_HEIGHT);parseInt(10*o/DEFAULT_CANVAS_HEIGHT);var r=parseInt(30*o/DEFAULT_CANVAS_HEIGHT),l=0;1==config.isDisplayChipBox&&(l=parseInt(18*o/DEFAULT_CANVAS_HEIGHT));var p=n+s+8,g=parseInt(66*o/DEFAULT_CANVAS_HEIGHT)+l;$("#canvas_pane").css({width:e+"px",height:o+"px"});var f=parseInt(210*o/DEFAULT_CANVAS_HEIGHT),h=parseInt(203*e/DEFAULT_CANVAS_WIDTH),_=parseInt(39*e/DEFAULT_CANVAS_WIDTH),u=parseInt(48*e/DEFAULT_CANVAS_WIDTH);$("#board").css({top:f+"px",left:h+"px"}),$("#board0").css({width:_+"px",height:u+"px",font:i+"pt Arial, sans-serif"}),$("#board1").css({width:_+"px",height:u+"px",font:i+"pt Arial, sans-serif"}),$("#board2").css({width:_+"px",height:u+"px",font:i+"pt Arial, sans-serif"}),$("#board3").css({width:_+"px",height:u+"px",font:i+"pt Arial, sans-serif"}),$("#board4").css({width:_+"px",height:u+"px",font:i+"pt Arial, sans-serif"}),$("#player0Box").css({left:"0px",top:o/2-g/2+"px",width:p+"px",height:g+"px"}),$("#player1Box").css({left:"0px",top:"0px",width:p+"px",height:g+"px"}),$("#player2Box").css({left:1*(e/3)-p/2+"px",top:"0px",width:p+"px",height:g+"px"}),$("#player3Box").css({left:2*(e/3)-p/2+"px",top:"0px",width:p+"px",height:g+"px"}),$("#player4Box").css({left:e-p+"px",top:"0px",width:p+"px",height:g+"px"}),$("#player5Box").css({left:e-p+"px",top:o/2-g/2+"px",width:p+"px",height:g+"px"}),$("#player6Box").css({left:e-p+"px",top:o-g+"px",width:p+"px",height:g+"px"}),$("#player7Box").css({left:2*(e/3)-p/2+"px",top:o-g+"px",width:p+"px",height:g+"px"}),$("#player8Box").css({left:1*(e/3)-p/2+"px",top:o-g+"px",width:p+"px",height:g+"px"}),$("#player9Box").css({left:"0px",top:o-g+"px",width:p+"px",height:g+"px"});for(var v=0;10>v;v++)$("#player"+v+"Hand").css({height:r+"px"}),$("#player"+v+"HandLeft").css({"padding-top":d+"px",font:i+"pt Arial, sans-serif"}),$("#player"+v+"HandRight").css({"padding-top":d+"px",font:i+"pt Arial, sans-serif"}),$("#player"+v+"Name").css({width:s+"px"}),$("#player"+v+"Dealer").css({width:n+"px","font-size":a+"pt"}),$("#player"+v+"Box").css({"font-size":a+"pt"}),$("#player"+v+"Odds").css({"font-size":a+"pt"}),$("#player"+v+"Chip").css({"font-size":a+"pt"}),$("#player"+v+"Folded").css({"font-size":t+"pt","padding-left":c+"px","padding-left":"-5px"})}function changePlayerName(e){var o=$("#inputPlayer"+e).val();emitUpdatePlayerName(e,o,$("#assistant_id").val())}function deletePlayer(e){$("#inputPlayer"+e).val(""),emitUpdatePlayerName(e,"",$("#assistant_id").val())}function changeChip(e){var o=$("#inputChip"+e).val();emitChipUpdate(e,o,$("#assistant_id").val())}function changeAction(){}function onClickProgression(e){$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active"),$("a#"+e).addClass("active")}function onClickMark(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("color_s color_h color_d color_c"),$("a#"+e).addClass("active"),$("a.card_selector.rank").addClass("color_"+e)}function onClickRank(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a#"+e).addClass("active")}function sendImage(e){emitImageSendWithPassWord(e,$("#assistant_id").val()),$("#message").html("send "+e),this.mark="",this.rank="　",showBalloon(e)}function onClickSend(){var e=$(".card_selector.progression.active").attr("id");if(e)sendImage(e);else{var o=$(".card_selector.mark.active").attr("id"),a=$(".card_selector.rank.active").attr("id");if(!(o&&a&&(o+"").match(markRegExp)&&(a+"").match(rankRegExp)))return;sendImage(a+o)}$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active")}function showBalloon(e){var o="send ";o+=2==e.length?e[0]:e,$("#send").showBalloon({contents:o,position:"right",showDuration:100,maxLifetime:3e3,hideDuration:500,classname:"send_balloon",css:{color:"#FFF",backgroundColor:"#4e5d6c",border:"solid 1px #2e3d4c",boxShadow:"2px 2px 2px #999"}}),$(".send_balloon").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c"),2==e.length&&$(".send_balloon").addClass("send_balloon mark_"+e[1]+" color_"+e[1])}var socket=io.connect("http://"+hostAddress+"/oddsSystem");socket.on("disconnect",function(){disConnected()}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null,videoWidth,videoHeight;navigator.getUserMedia({video:!0,audio:!1},function(e){video.src=window.URL.createObjectURL(e),video.addEventListener("loadeddata",function(){videoWidth=video.videoWidth,videoHeight=video.videoHeight,console.log("videoWidth = "+videoWidth+", videoHeight = "+videoHeight),setDefaultSize()},!1)},function(e){console.log(e)});var DEFAULT_CANVAS_WIDTH=640,DEFAULT_CANVAS_HEIGHT=360,KEY_CODE_ESC=27,canvasForVideo,config={canvasWidth:DEFAULT_CANVAS_WIDTH,canvasHeight:DEFAULT_CANVAS_HEIGHT,background:"camera",videoSourceX:0,videoSourceY:0,videoSourceWidth:DEFAULT_CANVAS_WIDTH,videoSourceHeight:DEFAULT_CANVAS_HEIGHT,videoDisplayX:0,videoDisplayY:0,videoDisplayWidth:DEFAULT_CANVAS_WIDTH,videoDisplayHeight:DEFAULT_CANVAS_HEIGHT,adjustToWindowResize:!1,isFullScreenMode:!1,isFullScreen169Mode:!1,colorPattern:"1",isDisplayChipBox:!1};$("#changeScreenSize").change(function(){switch($(this).val()){case"defaultSize":setDefaultSize();break;case"camera":setCameraSize();break;case"fullScreen":fullScreenMode();break;case"16:9_fullScreen":fullScreen169Mode()}setLayoutRound()}),$("#changeBackground").change(function(){switch(config.background=$(this).val(),$(this).val()){case"green":$("#canvas_pane").attr("class","wall_green"),config.colorPattern="3";break;case"blue":$("#canvas_pane").attr("class","wall_blue"),config.colorPattern="2";break;case"RGB(255,255,0)":$("#canvas_pane").attr("class","wall_yellow"),config.colorPattern="1";break;default:$("#canvas_pane").attr("class","wall_"+config.background),config.colorPattern="1"}hideTable(),drawTableInfo(lastTableInfo)}),setInterval(function(){config.ctxForVideo&&"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)},50),$(window).resize(function(){return config.adjustToWindowResize!==!1?config.isFullScreenMode===!0?(setSizeToFullScreen(),void 0):(config.isFullScreen169Mode===!0&&setSizeToFullScreen169(),void 0):void 0}),$(window).keydown(function(e){config.adjustToWindowResize===!0&&e.keyCode===KEY_CODE_ESC&&setDefaultSize()}),$(function(){$(".container").css({width:"auto","padding-left":"0px","padding-right":"0px"}),canvasForVideo=$("#canvasForVideo").get(0),canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.ctxForVideo=canvasForVideo.getContext("2d")});var lastTableInfo={},oddsList=[];addUpdateTableInfoListener(drawTableInfo),addUpdatePasswordListener(setPassword),$(function(){setLayoutRound(),$(".selectpicker").selectpicker({selectedText:"cat"}),$(".selectpicker.btn").addClass("btn-sm"),$(".draggable").draggable({containment:"#canvas_pane"}),$(".playerList.0").addClass("stripe_a"),$(".playerList.1").addClass("stripe_b"),$("#showAdditionalForm").on("click",function(){config.isDisplayChipBox=0==config.isDisplayChipBox?!0:!1,setLayoutRound(),$(".actionBox").toggle(),$(".chipBox").toggle(),$(".action_form").toggle(),$(".chip_form").toggle()}),$("#howto_header").on("click",function(){$("#howto_items").collapse("toggle")}),$("#direction_header").on("click",function(){$("#direction_items").collapse("toggle")}),$("#player_header").on("click",function(){$("#player_items").collapse("toggle")}),$("#config_header").on("click",function(){$("#config_items").collapse("toggle")}),$("#card_selector_toggle").on("click",function(){$("#card_selector").slideToggle()}),$("#assistant_id").on("focusout",function(){var e=$(this).val();e?(emitChangeAssistantMode("Assistant"),emitUpdateAssistantPassword($("#assistant_id").val())):(emitChangeAssistantMode("Original"),emitUpdateAssistantPassword(""))}),$("#caption").on("keyup",function(){var e=$(this).val();emitCaptionMessage(e,$("#assistant_id").val())}),$("#description").on("keyup",function(){var e=$(this).val();emitDescriptionMessage(e,$("#assistant_id").val())}),$("#layoutSetDefault").on("click",function(){setLayoutRound()}),$("#layoutShow").on("click",function(){$("#captionBox").show(),$("#descriptionBox").show(),$(".board").show(),$(".playerBox").show()})});var markRegExp=/[shdc]/,rankRegExp=/[2-9TJQKA]/,cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];