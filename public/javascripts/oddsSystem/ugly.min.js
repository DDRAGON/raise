function drawTableInfo(a){var e=a.players,t=a.board;clear(),setDealerButton(a.button);for(var s in e){var n=e[s];n&&(1==n.isActive&&($("#player"+n.seatId+"Box").css({opacity:"1.0"}),$("#player"+n.seatId+"Folded").hide()),setHand(n.seatId,n.hand,n.isActive),setName(n.seatId,n.name),setOdds(n.seatId,n.win,n.tie),tableInfo.players&&tableInfo.players[s]&&1==tableInfo.players[s].isActive&&0==n.isActive&&(tableInfo=a,setFold(s)))}setBoard(t),updateInputPlayerNames(e)}function clear(){$(".playerBox").hide()}function setDealerButton(a){$(".dealer").removeClass("on"),$("#player"+a+"Dealer").addClass("on")}function setHand(a,e,t){return $leftCard=$("#player"+a+"HandLeft"),$rightCard=$("#player"+a+"HandRight"),t?(e&&e[0]?setCard($leftCard,e[0]):clearCard($leftCard),e&&e[1]?setCard($rightCard,e[1]):clearCard($rightCard),void 0):(clearCard($leftCard),clearCard($rightCard),void 0)}function setCard(a,e){a.text(e.charAt(0)),a.addClass(e.charAt(1)),a.fadeIn()}function clearCard(a){a.hide(),a.removeClass("s h d c"),a.text("")}function setName(a,e){e&&($("#player"+a+"Box").show(),$("#player"+a+"Name").text(e))}function setFold(a){$("#player"+a+"Folded").show().textillate({"in":{effect:"swing"},callback:function(){$("#player"+a+"Box").stop().animate({opacity:"0.5"},600)}}).textillate("start")}function setOdds(a,e,t){if(!e)return $("#player"+a+"Odds").text(""),void 0;var s=Math.round(10*Number(e.slice(0,-1)))/10+"％";if(t){var n=Math.round(10*Number(t.slice(0,-1)))/10;n>=5&&(s+="("+n+"％)")}$("#player"+a+"Odds").text(s)}function setBoard(a){if(!a||0>=a.length)return $(".board").fadeOut(200,function(){$(".board.card").removeClass("s h d c"),$(".board.card").text("")}),void 0;$("#board").show();for(var e in a){var t=a[e];$card=$("#board"+e),$card.fadeIn(),$card.text(t.charAt(0)),$card.addClass(t.charAt(1))}}function updateInputPlayerNames(a){for(var e=0;10>e;e++)if(a[e]){var t=a[e];$("#inputPlayer"+e).val(t.name)}else $("#inputPlayer"+e).val("")}function markClick(a){this.mark=a,drawImage()}function numClick(a){this.num=a,drawImage()}function sendImage(a){if(socket.emit("imageSendWithPassWord",{image:a,passWord:$("#passwordArea").val()}),sound(),$("#message").html("send "+a),this.mark="",this.num="　",drawImage(),drawSentImage(a),"start"==a)for(var e=0;10>e;e++)$("#inputPlayer"+e).val("")}function sendCard(){return"s"!=this.mark&&"h"!=this.mark&&"d"!=this.mark&&"c"!=this.mark?($("#message").html("mark is invalid!"),void 0):"2"!=this.num&&"3"!=this.num&&"4"!=this.num&&"5"!=this.num&&"6"!=this.num&&"7"!=this.num&&"8"!=this.num&&"9"!=this.num&&"T"!=this.num&&"J"!=this.num&&"Q"!=this.num&&"K"!=this.num&&"A"!=this.num?($("#message").html("number is invalid!"),void 0):(sendImage(this.num+this.mark),void 0)}function drawImage(){switch(this.mark){case"s":$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"♠</span>");break;case"h":$("#image").html('<span style="color:#ff0000;font-size:64px;">'+this.num+"♥</span>");break;case"d":$("#image").html('<span style="color:#0000ff;font-size:64px;">'+this.num+"♦</span>");break;case"c":$("#image").html('<span style="color:#00bb00;font-size:64px;">'+this.num+"♣</span>");break;default:$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"</span>")}}function drawSentImage(a){switch(a[1]){case"s":$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+a[0]+"♠</span>");break;case"h":$("#sentImage").html('<span style="color:#ff0000;font-size:64px;">'+a[0]+"♥</span>");break;case"d":$("#sentImage").html('<span style="color:#0000ff;font-size:64px;">'+a[0]+"♦</span>");break;case"c":$("#sentImage").html('<span style="color:#00bb00;font-size:64px;">'+a[0]+"♣</span>");break;default:$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+a[0]+"</span>")}}function keyDown(){var a=$("#inputArea").val().toUpperCase()+String.fromCharCode(event.keyCode).toLowerCase();if(1==easyMode){var e=cardsForEasyMode.indexOf(a);if(e>=0)return sendImage(cards[e]),setTimeout(function(){$("#inputArea").val("")},100),void 0;"g"==a&&(sound(),setTimeout(function(){$("#inputArea").val("")},100))}else cards.indexOf(a)>=0&&(sendImage(a),setTimeout(function(){$("#inputArea").val("")},100))}function setLocationSide(){$("#player0Box").css({left:"0px",top:"10px"}),$("#player1Box").css({left:"0px",top:"80px"}),$("#player2Box").css({left:"0px",top:"150px"}),$("#player3Box").css({left:"0px",top:"220px"}),$("#player4Box").css({left:"0px",top:"290px"}),$("#player5Box").css({left:"560px",top:"10px"}),$("#player6Box").css({left:"560px",top:"80px"}),$("#player7Box").css({left:"560px",top:"150px"}),$("#player8Box").css({left:"560px",top:"220px"}),$("#player9Box").css({left:"560px",top:"290px"})}function setLocationRound(){$("#player0Box").css({left:"0px",top:"150px"}),$("#player1Box").css({left:"40px",top:"0px"}),$("#player2Box").css({left:"200px",top:"0px"}),$("#player3Box").css({left:"360px",top:"0px"}),$("#player4Box").css({left:"520px",top:"0px"}),$("#player5Box").css({left:"560px",top:"150px"}),$("#player6Box").css({left:"520px",top:"294px"}),$("#player7Box").css({left:"360px",top:"294px"}),$("#player8Box").css({left:"200px",top:"294px"}),$("#player9Box").css({left:"40px",top:"294px"})}function keyUpAssistantPassword(){socket.emit("updateAssistantPassword",$("#passwordArea").val())}function changePlayerName(a){var e=$("#inputPlayer"+a).val();socket.emit("updatePlayerName",{seatId:a,name:e,passWord:$("#passwordArea").val()})}function deletePlayer(a){$("#inputPlayer"+a).val(""),socket.emit("updatePlayerName",{seatId:a,name:"",passWord:$("#passwordArea").val()})}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null;navigator.getUserMedia({video:!0,audio:!1},function(a){video.src=window.URL.createObjectURL(a)},function(a){console.log(a)});var socket=io.connect("http://"+hostAddress+"/oddsSystem"),easyMode=!1,assistantMode="Original",mark="",num="　",passWord="",background="camera",canvasForVideo,tableInfo={},config={canvasWidth:640,canvasHeight:360,originalCardWidth:48,originalCardHeight:64,displayCardWidth:36,displayCardHeight:48,space:8,boardWidthSpace:6,boardHeightSpace:6,cardFontSize:26,fontSize:14,visibility:.3,PlayersXY:[],nameFontMargin:3};config.markFontSize=config.cardFontSize-4,config.markAdjust=config.cardFontSize-parseInt(config.cardFontSize/3),config.displayCardWidth=2*config.cardFontSize-11,config.displayCardHeight=config.cardFontSize,config.displayWidth=2*config.displayCardWidth,config.nameBoxHeight=config.fontSize+2*config.nameFontMargin,config.nameWinPerBoxWidth=config.displayWidth,config.nameWinPerBoxHeight=2*(config.fontSize+2*config.nameFontMargin),config.displayHeight=config.displayCardHeight+config.nameWinPerBoxHeight,config.boxWidth=config.displayWidth,config.boxHeight=config.displayHeight,config.boardWidth=5*config.displayCardWidth+2*config.boardWidthSpace,config.boardHeight=config.cardFontSize+2*config.boardHeightSpace,config.tieFontSize=config.fontSize-4,config.dealerButtonRadius=parseInt(config.nameWinPerBoxHeight/2);var ASSISTANT_MODE_ORIGINAL="Original",ASSISTANT_MODE_ASSISTANT="Assistant";$(function(){canvasForVideo=$("#canvasForVideo").get(0),config.ctxForVideo=canvasForVideo.getContext("2d")}),$("#changeBackground").change(function(){background=$(this).val(),$("#canvas_pane").attr("class","wall_"+background)}),socket.on("tableInfo",function(a){drawTableInfo(a),tableInfo=a}),socket.on("passWord",function(a){passWord=a}),setInterval(function(){return config.ctxForVideo?"camera"===background?(config.ctxForVideo.drawImage(video,0,0,config.canvasWidth,config.canvasHeight),void 0):void 0:void 0},50);var cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];$("#changeInputMode").change(function(){switch($(this).val()){case"easy":easyMode=!0;break;case"normal":easyMode=!1;break;case"qrCode":return document.getElementById("inputArea").innerHTML=passWord,void 0}document.getElementById("inputArea").innerHTML='<input type="text" onkeydown="keyDown();" id="inputArea" class="form-control">'}),$("#changeAssistantMode").change(function(){assistantMode=$(this).val(),socket.emit("changeAssistantMode",assistantMode);var a='<span style="color:#000000;font-size:18px;">　'+assistantMode+"</span>";switch(assistantMode){case"Original":socket.emit("updateAssistantPassword","");break;case"Assistant":a+='<br>pass word:<input type="password" onkeyup="keyUpAssistantPassword();" id="passwordArea">'}$("#AssistantModeDisplay").html(a)}),$(function(){$(".playerList.0").css({backgroundColor:"#F6F6F6"}),setLocationRound(),$(".draggable").draggable({containment:"#canvas_pane",snap:"#canvas_pane"}),$("#plain_form").on("click",function(){$(".action_form").hide(),$(".chip_form").hide()}),$("#plain_action_form").on("click",function(){$(".action_form").show(),$(".chip_form").hide()}),$("#plain_action_chip_form").on("click",function(){$(".action_form").show(),$(".chip_form").show()}),$("#changeArrangement").change(function(){switch($(this).val()){case"上下":setLocationRound();break;case"左右":setLocationSide()}})});