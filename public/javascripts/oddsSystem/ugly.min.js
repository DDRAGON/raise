function markClick(n){this.mark=n,drawImage()}function numClick(n){this.num=n,drawImage()}function sendImage(n){if(socket.emit("imageSendWithPassWord",{image:n,passWord:$("#passwordArea").val()}),sound(),$("#message").html("send "+n),this.mark="",this.num="　",drawImage(),drawSentImage(n),"start"==n)for(var a=0;10>a;a++)$("#inputPlayer"+a).val("")}function sendCard(){return"s"!=this.mark&&"h"!=this.mark&&"d"!=this.mark&&"c"!=this.mark?($("#message").html("mark is invalid!"),void 0):"2"!=this.num&&"3"!=this.num&&"4"!=this.num&&"5"!=this.num&&"6"!=this.num&&"7"!=this.num&&"8"!=this.num&&"9"!=this.num&&"T"!=this.num&&"J"!=this.num&&"Q"!=this.num&&"K"!=this.num&&"A"!=this.num?($("#message").html("number is invalid!"),void 0):(sendImage(this.num+this.mark),void 0)}function drawImage(){switch(this.mark){case"s":$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"♠</span>");break;case"h":$("#image").html('<span style="color:#ff0000;font-size:64px;">'+this.num+"♥</span>");break;case"d":$("#image").html('<span style="color:#0000ff;font-size:64px;">'+this.num+"♦</span>");break;case"c":$("#image").html('<span style="color:#00bb00;font-size:64px;">'+this.num+"♣</span>");break;default:$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"</span>")}}function drawSentImage(n){switch(n[1]){case"s":$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+n[0]+"♠</span>");break;case"h":$("#sentImage").html('<span style="color:#ff0000;font-size:64px;">'+n[0]+"♥</span>");break;case"d":$("#sentImage").html('<span style="color:#0000ff;font-size:64px;">'+n[0]+"♦</span>");break;case"c":$("#sentImage").html('<span style="color:#00bb00;font-size:64px;">'+n[0]+"♣</span>");break;default:$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+n[0]+"</span>")}}function keyDown(){var n=$("#inputArea").val().toUpperCase()+String.fromCharCode(event.keyCode).toLowerCase();if(1==easyMode){var a=cardsForEasyMode.indexOf(n);if(a>=0)return sendImage(cards[a]),setTimeout(function(){$("#inputArea").val("")},100),void 0;"g"==n&&(sound(),setTimeout(function(){$("#inputArea").val("")},100))}else cards.indexOf(n)>=0&&(sendImage(n),setTimeout(function(){$("#inputArea").val("")},100))}function keyUpPlayer(n){var a=$("#inputPlayer"+n).val();socket.emit("updatePlayerName",{seatId:n,name:a,passWord:$("#passwordArea").val()})}function deletePlayer(n){$("#inputPlayer"+n).val(""),socket.emit("updatePlayerName",{seatId:n,name:"",passWord:$("#passwordArea").val()})}function keyUpAssistantPassword(){socket.emit("updateAssistantPassword",$("#passwordArea").val())}function sound(){var n="";n+="<EMBED id = 'id_sound'",n+=" SRC=/music/cursor6.wav",n+=" AUTOSTART='true'",n+=" HIDDEN='true'>",document.getElementById("id_sound").innerHTML=n}function drawTableInfo(n){var a=n.players,i=n.board;drawBackGround();for(var e in a){var o=a[e];o&&(tableInfo.players&&tableInfo.players[e]&&1==tableInfo.players[e].isActive&&0==o.isActive&&(tableInfo=n,foldMovie(e,0)),drawBox(o.seatId,o.isActive),1==o.isActive&&drawPlayerHands(o.seatId,o.hand),drawPlayerWinperAndName(o.seatId,o.win,o.tie,o.name,o.isActive),i&&i.length>0&&drawBoard(i))}drawDealerButton(n.button),updateInputPlayerNames(a)}function drawBackGround(){config.ctx.clearRect(0,0,config.canvasWidth,config.canvasHeight)}function drawBox(n,a){setColorAndFont("black",0),0==a&&(config.ctx.fillStyle="rgba(0, 0, 0, "+config.visibility+")"),config.ctx.fillRect(config.PlayersXY[n].nameX,config.PlayersXY[n].nameY,config.boxWidth,parseInt(config.nameWinPerBoxHeight/2)),setColorAndFont("white",0),0==a&&(config.ctx.fillStyle="rgba(255, 255, 255, "+(config.visibility+.1)+")"),config.ctx.fillRect(config.PlayersXY[n].winPerX,config.PlayersXY[n].winPerY,config.boxWidth,parseInt(config.nameWinPerBoxHeight/2))}function drawDealerButton(n){setColorAndFont("white",0),config.ctx.beginPath(),config.ctx.arc(config.PlayersXY[n].dealerButtonX+config.dealerButtonRadius,config.PlayersXY[n].dealerButtonY+config.dealerButtonRadius,config.dealerButtonRadius,0,2*Math.PI,!1),config.ctx.fill(),setColorAndFont("green",config.fontSize+8),config.ctx.fillText("D",config.PlayersXY[n].dealerButtonX+config.dealerButtonRadius-parseInt(config.dealerButtonRadius/2),config.PlayersXY[n].dealerButtonY+parseInt(3*config.dealerButtonRadius/2))}function drawPlayerHands(n,a){a&&a[0]&&drawCard(a[0],config.PlayersXY[n].handsX,config.PlayersXY[n].handsY),a&&a[1]&&drawCard(a[1],config.PlayersXY[n].handsX+config.displayCardWidth,config.PlayersXY[n].handsY)}function foldMovie(n,a){drawTableInfo(tableInfo),a>=foldAnimationYs.length||(setColorAndFont("red",2*config.fontSize),config.ctx.fillText("Fold",config.PlayersXY[n].handsX+2,config.PlayersXY[n].handsY+config.displayCardHeight-foldAnimationYs[a]),setTimeout(function(){foldMovie(n,a+1)},50))}function drawPlayerWinperAndName(n,a,i,e,o){if(setColorAndFont("white",config.fontSize),o&&0==o&&(config.ctx.fillStyle="rgba(255, 255, 255, "+config.visibility+")"),e&&config.ctx.fillText(e,config.PlayersXY[n].nameX,config.PlayersXY[n].nameY+config.fontSize+config.nameFontMargin),void 0!==o){if(0==o)return config.ctx.fillStyle="rgba(0, 0, 0, "+(config.visibility+.1)+")",config.ctx.fillText("Fold",config.PlayersXY[n].winPerX+2,config.PlayersXY[n].winPerY+config.fontSize+config.nameFontMargin),void 0;if(setColorAndFont("black",config.fontSize),a){var t=Math.round(10*Number(a.slice(0,-1)))/10,r=t+"％";if(i){var s=Math.round(10*Number(i.slice(0,-1)))/10;s>=5&&(r+="("+s+"％)",setColorAndFont("black",config.tieFontSize))}config.ctx.fillText(r,config.PlayersXY[n].winPerX,config.PlayersXY[n].winPerY+config.fontSize+config.nameFontMargin)}}}function drawBoard(n){setColorAndFont("green",0);var a=Number(config.canvasWidth/2)-Number(config.boardWidth/2),i=config.canvasHeight-config.boxHeight-2*config.dealerButtonRadius-config.boardHeight;config.ctx.fillRect(a,i,config.boardWidth,config.boardHeight),a+=config.boardWidthSpace,i+=config.boardHeightSpace;for(var e in n){var o=n[e];drawCard(o,a,i),a+=config.displayCardWidth}}function drawCard(n,a,i){switch(setColorAndFont("white",0),config.ctx.fillRect(a,i,2*config.cardFontSize-11,config.cardFontSize),drawX=a+2,drawY=i+config.cardFontSize-3,n.charAt(1)){case"s":return setColorAndFont("black",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("black",config.markFontSize),config.ctx.fillText("♠",drawX+config.markAdjust,drawY),void 0;case"c":return setColorAndFont("green",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("green",config.markFontSize),config.ctx.fillText("♣",drawX+config.markAdjust,drawY),void 0;case"d":return setColorAndFont("blue",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("blue",config.markFontSize),config.ctx.fillText("♦",drawX+config.markAdjust,drawY),void 0;case"h":return setColorAndFont("red",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("red",config.markFontSize),config.ctx.fillText("♥",drawX+config.markAdjust,drawY),void 0}}function updateInputPlayerNames(n){for(var a=0;10>a;a++)if(n[a]){var i=n[a];$("#inputPlayer"+a).val(i.name)}else $("#inputPlayer"+a).val("")}function calcUpAndDownXYs(){var n=parseInt(config.canvasHeight/2),a=n-parseInt((config.displayCardHeight+config.nameWinPerBoxHeight)/2);config.PlayersXY[0]={x:0,y:a},config.PlayersXY[0].dealerButtonX=config.PlayersXY[0].x+2*config.displayCardWidth,config.PlayersXY[0].dealerButtonY=config.PlayersXY[0].y+config.displayCardHeight;for(var i=0;4>i;i++){var e=i+1,o=parseInt(config.canvasWidth/4),t=i*o+parseInt(o/2)-parseInt(config.boxWidth/2);config.PlayersXY[e]={x:t,y:0},config.PlayersXY[e].dealerButtonX=t+parseInt(config.boxWidth/2)-config.dealerButtonRadius,config.PlayersXY[e].dealerButtonY=config.boxHeight}config.PlayersXY[5]={x:config.canvasWidth-config.boxWidth,y:a},config.PlayersXY[5].dealerButtonX=config.PlayersXY[5].x-2*config.dealerButtonRadius,config.PlayersXY[5].dealerButtonY=config.PlayersXY[5].y+config.displayCardHeight;for(var i=0;4>i;i++){var e=i+6,o=parseInt(config.canvasWidth/4),t=(3-i)*o+parseInt(o/2)-parseInt(config.boxWidth/2);config.PlayersXY[e]={x:t,y:config.canvasHeight-config.boxHeight},config.PlayersXY[e].dealerButtonX=t+parseInt(config.boxWidth/2)-config.dealerButtonRadius,config.PlayersXY[e].dealerButtonY=config.canvasHeight-config.boxHeight-2*config.dealerButtonRadius}for(var e=0;10>e;e++)calcHandNameWinPerPositions(e)}function calcLeftAndRightXYs(){for(var n=parseInt(config.canvasHeight/5),a=0;5>a;a++)config.PlayersXY[a]={x:0,y:n*a},config.PlayersXY[a].dealerButtonX=config.PlayersXY[a].x+2*config.displayCardWidth,config.PlayersXY[a].dealerButtonY=config.PlayersXY[a].y+config.displayCardHeight,calcHandNameWinPerPositions(a);for(var a=5;10>a;a++)config.PlayersXY[a]={x:config.canvasWidth-config.boxWidth,y:n*(a-5)},config.PlayersXY[a].dealerButtonX=config.PlayersXY[a].x-2*config.dealerButtonRadius,config.PlayersXY[a].dealerButtonY=config.PlayersXY[a].y+config.displayCardHeight,calcHandNameWinPerPositions(a)}function calcCenterXYs(){var n=config.canvasWidth-2*config.displayCardWidth,a=config.canvasHeight-(config.displayCardHeight+config.nameWinPerBoxHeight);config.PlayersXY[0]={x:parseInt(0*n/5),y:parseInt(2*a/4)},config.PlayersXY[1]={x:parseInt(1*n/5),y:parseInt(1*a/4)},config.PlayersXY[2]={x:parseInt(2*n/5),y:parseInt(0*a/4)},config.PlayersXY[3]={x:parseInt(3*n/5),y:parseInt(0*a/4)},config.PlayersXY[4]={x:parseInt(4*n/5),y:parseInt(1*a/4)},config.PlayersXY[5]={x:parseInt(5*n/5),y:parseInt(2*a/4)},config.PlayersXY[6]={x:parseInt(4*n/5),y:parseInt(3*a/4)},config.PlayersXY[7]={x:parseInt(3*n/5),y:parseInt(4*a/4)},config.PlayersXY[8]={x:parseInt(2*n/5),y:parseInt(4*a/4)},config.PlayersXY[9]={x:parseInt(1*n/5),y:parseInt(3*a/4)},config.PlayersXY[1].x-=config.dealerButtonRadius,config.PlayersXY[1].y-=config.dealerButtonRadius,config.PlayersXY[4].x+=config.dealerButtonRadius,config.PlayersXY[4].y-=config.dealerButtonRadius,config.PlayersXY[6].x+=config.dealerButtonRadius,config.PlayersXY[6].y+=config.dealerButtonRadius,config.PlayersXY[9].x-=config.dealerButtonRadius,config.PlayersXY[9].y+=config.dealerButtonRadius;for(var i=0;10>i;i++)config.PlayersXY[i].x+=config.displayCardWidth,config.PlayersXY[i].y+=parseInt((config.displayCardHeight+config.nameWinPerBoxHeight)/2)-3,config.PlayersXY[i].handsX=config.PlayersXY[i].x-config.displayCardWidth,config.PlayersXY[i].handsY=config.PlayersXY[i].y-config.displayCardHeight,config.PlayersXY[i].nameX=config.PlayersXY[i].x-config.displayCardWidth,config.PlayersXY[i].nameY=config.PlayersXY[i].y+config.fontSize-2,config.PlayersXY[i].winPerX=config.PlayersXY[i].x-config.displayCardWidth,config.PlayersXY[i].winPerY=config.PlayersXY[i].y+config.nameWinPerBoxHeight-2;config.PlayersXY[0].dealerButtonX=config.PlayersXY[0].x+config.displayCardWidth+config.dealerButtonRadius,config.PlayersXY[0].dealerButtonY=config.PlayersXY[0].y,config.PlayersXY[1].dealerButtonX=config.PlayersXY[1].x+2*config.dealerButtonRadius,config.PlayersXY[1].dealerButtonY=config.PlayersXY[1].y+config.nameWinPerBoxHeight,config.PlayersXY[2].dealerButtonX=config.PlayersXY[2].x,config.PlayersXY[2].dealerButtonY=config.PlayersXY[2].y+config.nameWinPerBoxHeight,config.PlayersXY[3].dealerButtonX=config.PlayersXY[3].x,config.PlayersXY[3].dealerButtonY=config.PlayersXY[3].y+config.nameWinPerBoxHeight,config.PlayersXY[4].dealerButtonX=config.PlayersXY[4].x-2*config.dealerButtonRadius,config.PlayersXY[4].dealerButtonY=config.PlayersXY[4].y+config.nameWinPerBoxHeight,config.PlayersXY[5].dealerButtonX=config.PlayersXY[5].x-config.displayCardWidth-config.dealerButtonRadius,config.PlayersXY[5].dealerButtonY=config.PlayersXY[5].y,config.PlayersXY[6].dealerButtonX=config.PlayersXY[6].x-2*config.dealerButtonRadius,config.PlayersXY[6].dealerButtonY=config.PlayersXY[6].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[7].dealerButtonX=config.PlayersXY[7].x,config.PlayersXY[7].dealerButtonY=config.PlayersXY[7].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[8].dealerButtonX=config.PlayersXY[8].x,config.PlayersXY[8].dealerButtonY=config.PlayersXY[8].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[9].dealerButtonX=config.PlayersXY[9].x+2*config.dealerButtonRadius,config.PlayersXY[9].dealerButtonY=config.PlayersXY[9].y-config.displayCardHeight-2*config.dealerButtonRadius}function calcHandNameWinPerPositions(n){config.PlayersXY[n].handsX=config.PlayersXY[n].x,config.PlayersXY[n].handsY=config.PlayersXY[n].y,config.PlayersXY[n].nameX=config.PlayersXY[n].x,config.PlayersXY[n].nameY=config.PlayersXY[n].y+config.displayCardHeight,config.PlayersXY[n].winPerX=config.PlayersXY[n].x,config.PlayersXY[n].winPerY=config.PlayersXY[n].y+config.displayCardHeight+config.nameBoxHeight}function setColorAndFont(n,a){config.ctx.fillStyle=n,config.ctx.font="bold "+a+"px 'ITC HIGHLANDER'"}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null;navigator.getUserMedia({video:!0,audio:!1},function(n){video.src=window.URL.createObjectURL(n)},function(n){console.log(n)});var socket=io.connect("http://"+hostAddress+"/oddsSystem"),easyMode=!1,assistantMode="Original",mark="",num="　",passWord="",backgroundColor="camera",canvasForVideo,canvas,tableInfo={},config={canvasWidth:640,canvasHeight:360,originalCardWidth:48,originalCardHeight:64,displayCardWidth:36,displayCardHeight:48,space:8,boardWidthSpace:6,boardHeightSpace:6,cardFontSize:26,fontSize:14,visibility:.3,PlayersXY:[],nameFontMargin:3};config.markFontSize=config.cardFontSize-4,config.markAdjust=config.cardFontSize-parseInt(config.cardFontSize/3),config.displayCardWidth=2*config.cardFontSize-11,config.displayCardHeight=config.cardFontSize,config.displayWidth=2*config.displayCardWidth,config.nameBoxHeight=config.fontSize+2*config.nameFontMargin,config.nameWinPerBoxWidth=config.displayWidth,config.nameWinPerBoxHeight=2*(config.fontSize+2*config.nameFontMargin),config.displayHeight=config.displayCardHeight+config.nameWinPerBoxHeight,config.boxWidth=config.displayWidth,config.boxHeight=config.displayHeight,config.boardWidth=5*config.displayCardWidth+2*config.boardWidthSpace,config.boardHeight=config.cardFontSize+2*config.boardHeightSpace,config.tieFontSize=config.fontSize-4,config.dealerButtonRadius=parseInt(config.nameWinPerBoxHeight/2);var cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"],ASSISTANT_MODE_ORIGINAL="Original",ASSISTANT_MODE_ASSISTANT="Assistant";$("#changeInputMode").change(function(){switch($(this).val()){case"easy":easyMode=!0;break;case"normal":easyMode=!1;break;case"qrCode":return document.getElementById("inputArea").innerHTML=passWord,void 0}document.getElementById("inputArea").innerHTML='<input type="text" onkeydown="keyDown();" id="inputArea" class="form-control">'}),$("#changeAssistantMode").change(function(){assistantMode=$(this).val(),socket.emit("changeAssistantMode",assistantMode);var n='<span style="color:#000000;font-size:18px;">　'+assistantMode+"</span>";switch(assistantMode){case"Original":socket.emit("updateAssistantPassword","");break;case"Assistant":n+='<br>pass word:<input type="password" onkeyup="keyUpAssistantPassword();" id="passwordArea">'}$("#AssistantModeDisplay").html(n)}),$("#changeArrangement").change(function(){switch($(this).val()){case"上下":calcUpAndDownXYs();break;case"左右":calcLeftAndRightXYs()}drawTableInfo(tableInfo)}),$("#changeBackground").change(function(){backgroundColor=$(this).val()}),$(function(){canvasForVideo=$("#canvasForVideo").get(0),canvas=$("#canvas").get(0),config.ctxForVideo=canvasForVideo.getContext("2d"),config.ctx=canvas.getContext("2d"),calcUpAndDownXYs()}),socket.on("tableInfo",function(n){drawTableInfo(n),tableInfo=n}),socket.on("passWord",function(n){passWord=n}),setInterval(function(){if(config.ctxForVideo){if("camera"===backgroundColor)return config.ctxForVideo.drawImage(video,0,0,config.canvasWidth,config.canvasHeight),void 0;config.ctxForVideo.fillStyle=backgroundColor,config.ctxForVideo.fillRect(0,0,config.canvasWidth,config.canvasHeight)}},50);var foldAnimationYs=[0,6,10,12,12,12,10,6,0,3,5,6,6,6,5,3,0,1,1,0,0,0,0];