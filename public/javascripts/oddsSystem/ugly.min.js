function addUpdateTableInfoListener(e){socket.on("tableInfo",e)}function addUpdatePasswordListener(e){socket.on("passWord",e)}function emitUpdatePlayerName(e,o,i){socket.emit("updatePlayerName",{seatId:e,name:o,passWord:i})}function emitChangeAssistantMode(e){socket.emit("changeAssistantMode",e)}function emitUpdateAssistantPassword(e){socket.emit("updateAssistantPassword",e)}function emitImageSendWithPassWord(e,o){socket.emit("imageSendWithPassWord",{image:e,passWord:o})}function redrawCamera(e,o,i,a,t,n,s,d){config.ctxForVideo.drawImage(video,e,o,i,a,t,n,s,d)}function setDefaultSize(){canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.canvasWidth=DEFAULT_CANVAS_WIDTH,config.canvasHeight=DEFAULT_CANVAS_HEIGHT,config.videoSourceX=parseInt((videoWidth-config.canvasWidth)/2),config.videoSourceY=parseInt((videoHeight-config.canvasHeight)/2),config.videoSourceWidth=DEFAULT_CANVAS_WIDTH,config.videoSourceHeight=DEFAULT_CANVAS_HEIGHT,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=DEFAULT_CANVAS_WIDTH,config.videoDisplayHeight=DEFAULT_CANVAS_HEIGHT,0>config.videoSourceX&&(config.videoSourceX=0,config.videoSourceWidth=videoWidth,config.videoDisplayX=Math.abs(config.videoSourceX),config.videoDisplayWidth=videoWidth),0>config.videoSourceY&&(config.videoSourceY=0,config.videoSourceHeight=videoHeight,config.videoDisplayY=Math.abs(config.videoSourceY),config.videoDisplayHeight=videoHeight),config.adjustToWindowResize=!1,config.isFullScreenMode=!1,config.isFullScreen169Mode=!1,$("#settings").show(),$(".navbar-wrapper").show(),$("#footer_contents").show(),displayUpdate()}function setCameraSize(){canvasForVideo.width=videoWidth,canvasForVideo.height=videoHeight,config.canvasWidth=videoWidth,config.canvasHeight=videoHeight,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=videoWidth,config.videoSourceHeight=videoHeight,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=videoWidth,config.videoDisplayHeight=videoHeight,displayUpdate()}function fullScreenMode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!0,config.isFullScreen169Mode=!1,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen()}function fullScreen169Mode(){config.adjustToWindowResize=!0,config.isFullScreenMode=!1,config.isFullScreen169Mode=!0,$("#settings").hide(),$(".navbar-wrapper").hide(),$("#footer_contents").hide(),setSizeToFullScreen169()}function setSizeToFullScreen(){var e=$(window).width(),o=$(window).height();canvasForVideo.width=e,canvasForVideo.height=o,config.canvasWidth=e,config.canvasHeight=o,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=o,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=o,displayUpdate()}function setSizeToFullScreen169(){var e=$(window).width(),o=Number(9*e/16);canvasForVideo.width=e,canvasForVideo.height=o,config.canvasWidth=e,config.canvasHeight=o,config.videoSourceX=0,config.videoSourceY=0,config.videoSourceWidth=e,config.videoSourceHeight=o,config.videoDisplayX=0,config.videoDisplayY=0,config.videoDisplayWidth=e,config.videoDisplayHeight=o,displayUpdate()}function displayUpdate(){$("#canvas_pane").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvasForVideo").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),$("#canvas").css({width:config.canvasWidth+"px",height:config.canvasHeight+"px"}),setLayoutRound(),"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)}function drawTableInfo(e){var o=e.players,i=e.board;displayInit(),displayDealerButton(e.button),displayBoard(i);for(var a in o){var t=o[a];t&&(isActive(t)&&resetPlayerBox(t.seatId),displayName(t.seatId,t.name),displayHand(t.seatId,t.hand,t.isActive),displayOdds(t.seatId,t.win,t.tie),lastTableInfo.players&&lastTableInfo.players[a]&&isActive(lastTableInfo.players[a])&&!isActive(t)&&displayFold(t.seatId))}calculateOddsStyle(),updateInputPlayerNames(o),lastTableInfo=e}function displayInit(){$(".playerBox").hide(),$("#caption").trigger("keyup"),$("#description").trigger("keyup"),$(".actionBox").removeClass("actionF actionC actionR actionA "),$(".chipBox").removeClass("actionF actionC actionR actionA "),$(".btn_action").removeClass("active"),$(".chipBox").text(""),$(".chip_form").children().val("")}function resetPlayerBox(e){$("#player"+e+"Folded").hide(),$("#player"+e+"Box").css({opacity:"1.0"})}function isActive(e){return 1==e.isActive}function displayDealerButton(e){$(".dealer").removeClass("on"),$("#player"+e+"Dealer").addClass("on")}function displayBoard(e){if(!e||0>=e.length)$(".board").fadeOut(200,function(){$(".board.card").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")});else{$("#board").show();for(var o in e){var i=e[o];$selector=$("#board"+o),$selector.fadeIn(),$selector.text(i.charAt(0)),$selector.addClass("color_"+i.charAt(1)),$selector.addClass("mark_"+i.charAt(1))}}}function displayHand(e,o,i){return $leftCard=$("#player"+e+"HandLeft"),$rightCard=$("#player"+e+"HandRight"),i?(o&&o[0]?displayCard($leftCard,o[0]):hideCard($leftCard),o&&o[1]?displayCard($rightCard,o[1]):hideCard($rightCard),void 0):(hideCard($leftCard),hideCard($rightCard),void 0)}function hideCard(e){e.hide(),e.removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c").text("")}function displayCard(e,o){e.text(o.charAt(0)),e.addClass("color_"+o.charAt(1)),e.addClass("mark_"+o.charAt(1)),e.fadeIn()}function displayName(e,o){o&&($("#player"+e+"Box").show(),$("#player"+e+"Name").text(o))}function displayFold(e){$("#player"+e+"Folded").show().textillate({"in":{effect:"swing"},callback:function(){$("#player"+e+"Box").stop().animate({opacity:"0.5"},600)}}).textillate("start")}function displayOdds(e,o,i){var a=$("#player"+e+"Odds");if(o){var t=Number(o.replace("%",""));i&&(t+=Number(i.replace("%",""))),t=Math.round(t),oddsList.push(t),a.attr("data-win",t).text(t+"%").show()}else a.hide()}function calculateOddsStyle(){var e=$(".odds");e.removeClass("max win");var o=Math.max.apply(null,oddsList);$(".odds[data-win='"+o+"']").addClass("max"),$(".odds[data-win='100']").addClass("win"),oddsList=[]}function updateInputPlayerNames(e){for(var o=0;10>o;o++)if(e[o]){var i=e[o];$("#inputPlayer"+o).val(i.name)}else $("#inputPlayer"+o).val("")}function setPassword(e){$("#room_id").attr("value",e)}function setLayoutRound(){var e=Number(config.canvasWidth),o=Number(config.canvasHeight),i=Number($("#player0Box").css("width").replace("px","")),a=Number($("#player0Box").css("height").replace("px",""));$("#player0Box").css({left:"0px",top:o/2-a/2+"px"}),$("#player1Box").css({left:"0px",top:"0px"}),$("#player2Box").css({left:1*(e/3)-i/2+"px",top:"0px"}),$("#player3Box").css({left:2*(e/3)-i/2+"px",top:"0px"}),$("#player4Box").css({left:e-i+"px",top:"0px"}),$("#player5Box").css({left:e-i+"px",top:o/2-a/2+"px"}),$("#player6Box").css({left:e-i+"px",top:o-a+"px"}),$("#player7Box").css({left:2*(e/3)-i/2+"px",top:o-a+"px"}),$("#player8Box").css({left:1*(e/3)-i/2+"px",top:o-a+"px"}),$("#player9Box").css({left:"0px",top:o-a+"px"})}function changePlayerName(e){var o=$("#inputPlayer"+e).val();emitUpdatePlayerName(e,o,$("#assistant_id").val())}function deletePlayer(e){$("#inputPlayer"+e).val(""),emitUpdatePlayerName(e,"",$("#assistant_id").val())}function changeChip(e){var o=$("#inputChip"+e).val();$("#player"+e+"Chip").text(o)}function changeAction(e,o){$(".player"+e+".btn_action").removeClass("active"),$("#inputAction"+o+e).addClass("active");var i=$("#player"+e+"Action"),a=$("#player"+e+"Chip");a.removeClass("actionF actionC actionR actionA "),a.addClass("action"+o),i.removeClass("actionF actionC actionR actionA "),i.addClass("action"+o),i.text(o),"A"==o?($("#inputChip"+e).val("All In"),$("#player"+e+"Chip").text("All In")):($("#inputChip"+e).val(""),$("#player"+e+"Chip").text("")),$("#inputChip"+e).focus()}function onClickProgression(e){$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active"),$("a#"+e).addClass("active")}function onClickMark(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("color_s color_h color_d color_c"),$("a#"+e).addClass("active"),$("a.card_selector.rank").addClass("color_"+e)}function onClickRank(e){$("a.card_selector.progression").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a#"+e).addClass("active")}function sendImage(e){emitImageSendWithPassWord(e,$("#assistant_id").val()),$("#message").html("send "+e),this.mark="",this.rank="ã€€",showBalloon(e)}function onClickSend(){var e=$(".card_selector.progression.active").attr("id");if(e)sendImage(e);else{var o=$(".card_selector.mark.active").attr("id"),i=$(".card_selector.rank.active").attr("id");if(!(o&&i&&(o+"").match(markRegExp)&&(i+"").match(rankRegExp)))return;sendImage(i+o)}$("a.card_selector.mark").removeClass("active"),$("a.card_selector.rank").removeClass("active"),$("a.card_selector.progression").removeClass("active")}function showBalloon(e){var o="send ";o+=2==e.length?e[0]:e,$("#send").showBalloon({contents:o,position:"right",showDuration:100,maxLifetime:3e3,hideDuration:500,classname:"send_balloon",css:{color:"#FFF",backgroundColor:"#4e5d6c",border:"solid 1px #2e3d4c",boxShadow:"2px 2px 2px #999"}}),$(".send_balloon").removeClass("color_s color_h color_d color_c mark_s mark_h mark_d mark_c"),2==e.length&&$(".send_balloon").addClass("send_balloon mark_"+e[1]+" color_"+e[1])}var socket=io.connect("http://"+hostAddress+"/oddsSystem");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null,videoWidth,videoHeight;navigator.getUserMedia({video:!0,audio:!1},function(e){video.src=window.URL.createObjectURL(e),video.addEventListener("loadeddata",function(){videoWidth=video.videoWidth,videoHeight=video.videoHeight,console.log("videoWidth = "+videoWidth+", videoHeight = "+videoHeight),setDefaultSize()},!1)},function(e){console.log(e)});var DEFAULT_CANVAS_WIDTH=640,DEFAULT_CANVAS_HEIGHT=360,KEY_CODE_ESC=27,canvasForVideo,config={canvasWidth:DEFAULT_CANVAS_WIDTH,canvasHeight:DEFAULT_CANVAS_HEIGHT,background:"camera",videoSourceX:0,videoSourceY:0,videoSourceWidth:DEFAULT_CANVAS_WIDTH,videoSourceHeight:DEFAULT_CANVAS_HEIGHT,videoDisplayX:0,videoDisplayY:0,videoDisplayWidth:DEFAULT_CANVAS_WIDTH,videoDisplayHeight:DEFAULT_CANVAS_HEIGHT,adjustToWindowResize:!1,isFullScreenMode:!1,isFullScreen169Mode:!1};$("#changeScreenSize").change(function(){switch($(this).val()){case"defaultSize":setDefaultSize();break;case"camera":setCameraSize();break;case"fullScreen":fullScreenMode();break;case"16:9_fullScreen":fullScreen169Mode()}setLayoutRound()}),$("#changeBackground").change(function(){config.background=$(this).val(),"RGB(255,255,0)"===config.background?$("#canvas_pane").attr("class","wall_yellow"):$("#canvas_pane").attr("class","wall_"+config.background)}),setInterval(function(){config.ctxForVideo&&"camera"===config.background&&redrawCamera(config.videoSourceX,config.videoSourceY,config.videoSourceWidth,config.videoSourceHeight,config.videoDisplayX,config.videoDisplayY,config.videoDisplayWidth,config.videoDisplayHeight)},50),$(window).resize(function(){return config.adjustToWindowResize!==!1?config.isFullScreenMode===!0?(setSizeToFullScreen(),void 0):(config.isFullScreen169Mode===!0&&setSizeToFullScreen169(),void 0):void 0}),$(window).keydown(function(e){config.adjustToWindowResize===!0&&e.keyCode===KEY_CODE_ESC&&setDefaultSize()}),$(function(){$(".container").css({width:"auto","padding-left":"0px","padding-right":"0px"}),canvasForVideo=$("#canvasForVideo").get(0),canvasForVideo.width=DEFAULT_CANVAS_WIDTH,canvasForVideo.height=DEFAULT_CANVAS_HEIGHT,config.ctxForVideo=canvasForVideo.getContext("2d")});var lastTableInfo={},oddsList=[];addUpdateTableInfoListener(drawTableInfo),addUpdatePasswordListener(setPassword),$(function(){setLayoutRound(),$(".selectpicker").selectpicker({selectedText:"cat"}),$(".selectpicker.btn").addClass("btn-sm"),$(".draggable").draggable({containment:"#canvas_pane"}),$(".playerList.0").addClass("stripe_a"),$(".playerList.1").addClass("stripe_b"),$("#showAdditionalForm").on("click",function(){$(".actionBox").toggle(),$(".chipBox").toggle(),$(".action_form").toggle(),$(".chip_form").toggle(),setLayoutRound()}),$("#howto_header").on("click",function(){$("#howto_items").collapse("toggle")}),$("#direction_header").on("click",function(){$("#direction_items").collapse("toggle")}),$("#player_header").on("click",function(){$("#player_items").collapse("toggle")}),$("#config_header").on("click",function(){$("#config_items").collapse("toggle")}),$("#card_selector_toggle").on("click",function(){$("#card_selector").slideToggle()}),$("#assistant_id").on("focusout",function(){var e=$(this).val();e?(emitChangeAssistantMode("Assistant"),emitUpdateAssistantPassword($("#assistant_id").val())):(emitChangeAssistantMode("Original"),emitUpdateAssistantPassword(""))}),$("#caption").on("keyup",function(){var e=$("#captionBox");e.text($(this).val()),e.text().length>0?e.show():e.hide()}),$("#description").on("keyup",function(){var e=$("#descriptionBox");e.text($(this).val()),e.text().length>0?e.show():e.hide()}),$("#layoutSetDefault").on("click",function(){setLayoutRound()}),$("#layoutShow").on("click",function(){$("#captionBox").show(),$("#descriptionBox").show(),$(".board").show(),$(".playerBox").show()})});var markRegExp=/[shdc]/,rankRegExp=/[2-9TJQKA]/,cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];