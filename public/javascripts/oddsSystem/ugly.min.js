function markClick(n){this.mark=n,drawImage()}function numClick(n){this.num=n,drawImage()}function sendImage(n){if(socket.emit("imageSend",n),sound(),$("#message").html("send "+n),this.mark="",this.num="　",drawImage(),drawSentImage(n),"start"==n)for(var e=0;10>e;e++)$("#inputPlayer"+e).val("")}function sendCard(){return"s"!=this.mark&&"h"!=this.mark&&"d"!=this.mark&&"c"!=this.mark?($("#message").html("mark is invalid!"),void 0):"2"!=this.num&&"3"!=this.num&&"4"!=this.num&&"5"!=this.num&&"6"!=this.num&&"7"!=this.num&&"8"!=this.num&&"9"!=this.num&&"T"!=this.num&&"J"!=this.num&&"Q"!=this.num&&"K"!=this.num&&"A"!=this.num?($("#message").html("number is invalid!"),void 0):(sendImage(this.num+this.mark),void 0)}function drawImage(){switch(this.mark){case"s":$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"♠</span>");break;case"h":$("#image").html('<span style="color:#ff0000;font-size:64px;">'+this.num+"♥</span>");break;case"d":$("#image").html('<span style="color:#0000ff;font-size:64px;">'+this.num+"♦</span>");break;case"c":$("#image").html('<span style="color:#00bb00;font-size:64px;">'+this.num+"♣</span>");break;default:$("#image").html('<span style="color:#000000;font-size:64px;">'+this.num+"</span>")}}function drawSentImage(n){switch(n[1]){case"s":$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+n[0]+"♠</span>");break;case"h":$("#sentImage").html('<span style="color:#ff0000;font-size:64px;">'+n[0]+"♥</span>");break;case"d":$("#sentImage").html('<span style="color:#0000ff;font-size:64px;">'+n[0]+"♦</span>");break;case"c":$("#sentImage").html('<span style="color:#00bb00;font-size:64px;">'+n[0]+"♣</span>");break;default:$("#sentImage").html('<span style="color:#000000;font-size:64px;">'+n[0]+"</span>")}}function keyDown(){var n=$("#inputArea").val().toUpperCase()+String.fromCharCode(event.keyCode).toLowerCase();if(1==easyMode){var e=cardsForEasyMode.indexOf(n);if(e>=0)return sendImage(cards[e]),setTimeout(function(){$("#inputArea").val("")},100),void 0;"g"==n&&(sound(),setTimeout(function(){$("#inputArea").val("")},100))}else cards.indexOf(n)>=0&&(sendImage(n),setTimeout(function(){$("#inputArea").val("")},100))}function keyUpPlayer(n){var e=$("#inputPlayer"+n).val();socket.emit("updatePlayerName",{seatId:n,name:e})}function deletePlayer(n){$("#inputPlayer"+n).val(""),socket.emit("updatePlayerName",{seatId:n,name:""})}function moveDealerButton(){socket.emit("moveDealerButton",{})}function sound(){var n="";n+="<EMBED id = 'id_sound'",n+=" SRC=/music/cursor6.wav",n+=" AUTOSTART='true'",n+=" HIDDEN='true'>",document.getElementById("id_sound").innerHTML=n}function drawTableInfo(n){var e=n.players,a=n.board;drawBackGround();for(var i in e){var o=e[i];o&&(drawBox(o.seatId),1==o.isActive&&drawPlayerHands(o.seatId,o.hand),drawPlayerWinperAndName(o.seatId,o.win,o.tie,o.name,o.isActive),a&&a.length>0&&drawBoard(a))}drawDealerButton(n.button)}function drawBackGround(){config.ctx.clearRect(0,0,config.canvasWidth,config.canvasHeight)}function drawBox(n){setColorAndFont("black",0),config.ctx.fillRect(config.PlayersXY[n].nameX,config.PlayersXY[n].nameY,config.boxWidth,parseInt(config.nameWinPerBoxHeight/2)),setColorAndFont("white",0),config.ctx.fillRect(config.PlayersXY[n].winPerX,config.PlayersXY[n].winPerY,config.boxWidth,parseInt(config.nameWinPerBoxHeight/2))}function drawDealerButton(n){setColorAndFont("white",0),config.ctx.beginPath(),config.ctx.arc(config.PlayersXY[n].dealerButtonX+config.dealerButtonRadius,config.PlayersXY[n].dealerButtonY+config.dealerButtonRadius,config.dealerButtonRadius,0,2*Math.PI,!1),config.ctx.fill(),setColorAndFont("green",config.fontSize+8),config.ctx.fillText("D",config.PlayersXY[n].dealerButtonX+config.dealerButtonRadius-parseInt(config.dealerButtonRadius/2),config.PlayersXY[n].dealerButtonY+parseInt(3*config.dealerButtonRadius/2))}function drawPlayerHands(n,e){e&&e[0]&&drawCard(e[0],config.PlayersXY[n].handsX,config.PlayersXY[n].handsY),e&&e[1]&&drawCard(e[1],config.PlayersXY[n].handsX+config.displayCardWidth,config.PlayersXY[n].handsY)}function drawPlayerWinperAndName(n,e,a,i,o){if(setColorAndFont("white",config.fontSize),i&&config.ctx.fillText(i,config.PlayersXY[n].nameX,config.PlayersXY[n].nameY+config.fontSize+config.nameFontMargin),void 0!==o){if(setColorAndFont("black",config.fontSize),0==o)return config.ctx.fillText("Fold",config.PlayersXY[n].winPerX,config.PlayersXY[n].winPerY+config.fontSize+config.nameFontMargin),void 0;if(e){var t=Math.round(10*Number(e.slice(0,-1)))/10,r=t+"％";if(a){var c=Math.round(10*Number(a.slice(0,-1)))/10;c>=5&&(r+="("+c+"％)",setColorAndFont("black",config.tieFontSize))}config.ctx.fillText(r,config.PlayersXY[n].winPerX,config.PlayersXY[n].winPerY+config.fontSize+config.nameFontMargin)}}}function drawBoard(n){setColorAndFont("green",0);var e=Number(config.canvasWidth/2)-Number(config.boardWidth/2),a=config.canvasHeight-config.boxHeight-2*config.dealerButtonRadius-config.boardHeight;config.ctx.fillRect(e,a,config.boardWidth,config.boardHeight),e+=config.boardWidthSpace,a+=config.boardHeightSpace;for(var i in n){var o=n[i];drawCard(o,e,a),e+=config.displayCardWidth}}function drawCard(n,e,a){switch(setColorAndFont("white",0),config.ctx.fillRect(e,a,2*config.cardFontSize-11,config.cardFontSize),drawX=e+2,drawY=a+config.cardFontSize-3,n.charAt(1)){case"s":return setColorAndFont("black",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("black",config.markFontSize),config.ctx.fillText("♠",drawX+config.markAdjust,drawY),void 0;case"c":return setColorAndFont("green",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("green",config.markFontSize),config.ctx.fillText("♣",drawX+config.markAdjust,drawY),void 0;case"d":return setColorAndFont("blue",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("blue",config.markFontSize),config.ctx.fillText("♦",drawX+config.markAdjust,drawY),void 0;case"h":return setColorAndFont("red",config.cardFontSize),config.ctx.fillText(n.charAt(0),drawX,drawY),setColorAndFont("red",config.markFontSize),config.ctx.fillText("♥",drawX+config.markAdjust,drawY),void 0}}function calcUpAndDownXYs(){var n=parseInt(config.canvasHeight/2),e=n-parseInt((config.displayCardHeight+config.nameWinPerBoxHeight)/2);config.PlayersXY[0]={x:0,y:e},config.PlayersXY[0].dealerButtonX=config.PlayersXY[0].x+2*config.displayCardWidth,config.PlayersXY[0].dealerButtonY=config.PlayersXY[0].y+config.displayCardHeight;for(var a=0;4>a;a++){var i=a+1,o=parseInt(config.canvasWidth/4),t=a*o+parseInt(o/2)-parseInt(config.boxWidth/2);config.PlayersXY[i]={x:t,y:0},config.PlayersXY[i].dealerButtonX=t+parseInt(config.boxWidth/2)-config.dealerButtonRadius,config.PlayersXY[i].dealerButtonY=config.boxHeight}config.PlayersXY[5]={x:config.canvasWidth-config.boxWidth,y:e},config.PlayersXY[5].dealerButtonX=config.PlayersXY[5].x-2*config.dealerButtonRadius,config.PlayersXY[5].dealerButtonY=config.PlayersXY[5].y+config.displayCardHeight;for(var a=0;4>a;a++){var i=a+6,o=parseInt(config.canvasWidth/4),t=(3-a)*o+parseInt(o/2)-parseInt(config.boxWidth/2);config.PlayersXY[i]={x:t,y:config.canvasHeight-config.boxHeight},config.PlayersXY[i].dealerButtonX=t+parseInt(config.boxWidth/2)-config.dealerButtonRadius,config.PlayersXY[i].dealerButtonY=config.canvasHeight-config.boxHeight-2*config.dealerButtonRadius}for(var i=0;10>i;i++)calcHandNameWinPerPositions(i)}function calcLeftAndRightXYs(){for(var n=parseInt(config.canvasHeight/5),e=0;5>e;e++)config.PlayersXY[e]={x:0,y:n*e},config.PlayersXY[e].dealerButtonX=config.PlayersXY[e].x+2*config.displayCardWidth,config.PlayersXY[e].dealerButtonY=config.PlayersXY[e].y+config.displayCardHeight,calcHandNameWinPerPositions(e);for(var e=5;10>e;e++)config.PlayersXY[e]={x:config.canvasWidth-config.boxWidth,y:n*(e-5)},config.PlayersXY[e].dealerButtonX=config.PlayersXY[e].x-2*config.dealerButtonRadius,config.PlayersXY[e].dealerButtonY=config.PlayersXY[e].y+config.displayCardHeight,calcHandNameWinPerPositions(e)}function calcCenterXYs(){var n=config.canvasWidth-2*config.displayCardWidth,e=config.canvasHeight-(config.displayCardHeight+config.nameWinPerBoxHeight);config.PlayersXY[0]={x:parseInt(0*n/5),y:parseInt(2*e/4)},config.PlayersXY[1]={x:parseInt(1*n/5),y:parseInt(1*e/4)},config.PlayersXY[2]={x:parseInt(2*n/5),y:parseInt(0*e/4)},config.PlayersXY[3]={x:parseInt(3*n/5),y:parseInt(0*e/4)},config.PlayersXY[4]={x:parseInt(4*n/5),y:parseInt(1*e/4)},config.PlayersXY[5]={x:parseInt(5*n/5),y:parseInt(2*e/4)},config.PlayersXY[6]={x:parseInt(4*n/5),y:parseInt(3*e/4)},config.PlayersXY[7]={x:parseInt(3*n/5),y:parseInt(4*e/4)},config.PlayersXY[8]={x:parseInt(2*n/5),y:parseInt(4*e/4)},config.PlayersXY[9]={x:parseInt(1*n/5),y:parseInt(3*e/4)},config.PlayersXY[1].x-=config.dealerButtonRadius,config.PlayersXY[1].y-=config.dealerButtonRadius,config.PlayersXY[4].x+=config.dealerButtonRadius,config.PlayersXY[4].y-=config.dealerButtonRadius,config.PlayersXY[6].x+=config.dealerButtonRadius,config.PlayersXY[6].y+=config.dealerButtonRadius,config.PlayersXY[9].x-=config.dealerButtonRadius,config.PlayersXY[9].y+=config.dealerButtonRadius;for(var a=0;10>a;a++)config.PlayersXY[a].x+=config.displayCardWidth,config.PlayersXY[a].y+=parseInt((config.displayCardHeight+config.nameWinPerBoxHeight)/2)-3,config.PlayersXY[a].handsX=config.PlayersXY[a].x-config.displayCardWidth,config.PlayersXY[a].handsY=config.PlayersXY[a].y-config.displayCardHeight,config.PlayersXY[a].nameX=config.PlayersXY[a].x-config.displayCardWidth,config.PlayersXY[a].nameY=config.PlayersXY[a].y+config.fontSize-2,config.PlayersXY[a].winPerX=config.PlayersXY[a].x-config.displayCardWidth,config.PlayersXY[a].winPerY=config.PlayersXY[a].y+config.nameWinPerBoxHeight-2;config.PlayersXY[0].dealerButtonX=config.PlayersXY[0].x+config.displayCardWidth+config.dealerButtonRadius,config.PlayersXY[0].dealerButtonY=config.PlayersXY[0].y,config.PlayersXY[1].dealerButtonX=config.PlayersXY[1].x+2*config.dealerButtonRadius,config.PlayersXY[1].dealerButtonY=config.PlayersXY[1].y+config.nameWinPerBoxHeight,config.PlayersXY[2].dealerButtonX=config.PlayersXY[2].x,config.PlayersXY[2].dealerButtonY=config.PlayersXY[2].y+config.nameWinPerBoxHeight,config.PlayersXY[3].dealerButtonX=config.PlayersXY[3].x,config.PlayersXY[3].dealerButtonY=config.PlayersXY[3].y+config.nameWinPerBoxHeight,config.PlayersXY[4].dealerButtonX=config.PlayersXY[4].x-2*config.dealerButtonRadius,config.PlayersXY[4].dealerButtonY=config.PlayersXY[4].y+config.nameWinPerBoxHeight,config.PlayersXY[5].dealerButtonX=config.PlayersXY[5].x-config.displayCardWidth-config.dealerButtonRadius,config.PlayersXY[5].dealerButtonY=config.PlayersXY[5].y,config.PlayersXY[6].dealerButtonX=config.PlayersXY[6].x-2*config.dealerButtonRadius,config.PlayersXY[6].dealerButtonY=config.PlayersXY[6].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[7].dealerButtonX=config.PlayersXY[7].x,config.PlayersXY[7].dealerButtonY=config.PlayersXY[7].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[8].dealerButtonX=config.PlayersXY[8].x,config.PlayersXY[8].dealerButtonY=config.PlayersXY[8].y-config.displayCardHeight-2*config.dealerButtonRadius,config.PlayersXY[9].dealerButtonX=config.PlayersXY[9].x+2*config.dealerButtonRadius,config.PlayersXY[9].dealerButtonY=config.PlayersXY[9].y-config.displayCardHeight-2*config.dealerButtonRadius}function calcHandNameWinPerPositions(n){config.PlayersXY[n].handsX=config.PlayersXY[n].x,config.PlayersXY[n].handsY=config.PlayersXY[n].y,config.PlayersXY[n].nameX=config.PlayersXY[n].x,config.PlayersXY[n].nameY=config.PlayersXY[n].y+config.displayCardHeight,config.PlayersXY[n].winPerX=config.PlayersXY[n].x,config.PlayersXY[n].winPerY=config.PlayersXY[n].y+config.displayCardHeight+config.nameBoxHeight}function setColorAndFont(n,e){config.ctx.fillStyle=n,config.ctx.font="bold "+e+"px 'ITC HIGHLANDER'"}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null;navigator.getUserMedia({video:!0,audio:!1},function(n){video.src=window.URL.createObjectURL(n)},function(n){console.log(n)});var socket=io.connect("http://"+hostAddress+"/oddsSystem"),easyMode=!1,mark="",num="　",passWord="",backgroundColor="camera",tableInfo={},config={canvasWidth:640,canvasHeight:360,originalCardWidth:48,originalCardHeight:64,displayCardWidth:36,displayCardHeight:48,space:8,boardWidthSpace:6,boardHeightSpace:6,cardFontSize:26,fontSize:12,PlayersXY:[],nameFontMargin:3};config.markFontSize=config.cardFontSize-4,config.markAdjust=config.cardFontSize-parseInt(config.cardFontSize/3),config.displayCardWidth=2*config.cardFontSize-11,config.displayCardHeight=config.cardFontSize,config.displayWidth=2*config.displayCardWidth,config.nameBoxHeight=config.fontSize+2*config.nameFontMargin,config.nameWinPerBoxWidth=config.displayWidth,config.nameWinPerBoxHeight=2*(config.fontSize+2*config.nameFontMargin),config.displayHeight=config.displayCardHeight+config.nameWinPerBoxHeight,config.boxWidth=config.displayWidth,config.boxHeight=config.displayHeight,config.boardWidth=5*config.displayCardWidth+2*config.boardWidthSpace,config.boardHeight=config.cardFontSize+2*config.boardHeightSpace,config.tieFontSize=config.fontSize-4,config.dealerButtonRadius=parseInt(config.nameWinPerBoxHeight/2);var cards=["As","2s","3s","4s","5s","6s","7s","8s","9s","Ts","Js","Qs","Ks","Ah","2h","3h","4h","5h","6h","7h","8h","9h","Th","Jh","Qh","Kh","Ad","2d","3d","4d","5d","6d","7d","8d","9d","Td","Jd","Qd","Kd","Ac","2c","3c","4c","5c","6c","7c","8c","9c","Tc","Jc","Qc","Kc"],cardsForEasyMode=["Ta","2a","3a","4a","5a","6a","7a","8a","9a","Qa","Wa","Ea","Ra","Ts","2s","3s","4s","5s","6s","7s","8s","9s","Qs","Ws","Es","Rs","Td","2d","3d","4d","5d","6d","7d","8d","9d","Qd","Wd","Ed","Rd","Tf","2f","3f","4f","5f","6f","7f","8f","9f","Qf","Wf","Ef","Rf"];$("#changeInputMode").change(function(){switch($(this).val()){case"easy":easyMode=!0;break;case"normal":easyMode=!1;break;case"qrCode":return document.getElementById("inputArea").innerHTML=passWord,void 0}document.getElementById("inputArea").innerHTML='<input type="text" onkeydown="keyDown();" id="inputArea" class="form-control">'}),$("#changeArrangement").change(function(){switch($(this).val()){case"上下":calcUpAndDownXYs();break;case"左右":calcLeftAndRightXYs()}drawTableInfo(tableInfo)}),$("#changeBackground").change(function(){backgroundColor=$(this).val()}),$(function(){var n=$("#canvasForVideo").get(0),e=$("#canvas").get(0);config.ctxForVideo=n.getContext("2d"),config.ctx=e.getContext("2d"),calcUpAndDownXYs()}),socket.on("tableInfo",function(n){tableInfo=n,drawTableInfo(tableInfo)}),socket.on("passWord",function(n){passWord=n}),setInterval(function(){return"camera"===backgroundColor?(config.ctxForVideo.drawImage(video,0,0,config.canvasWidth,config.canvasHeight),void 0):(config.ctxForVideo.fillStyle=backgroundColor,config.ctxForVideo.fillRect(0,0,config.canvasWidth,config.canvasHeight),void 0)},50);