function sendImage(a){("ng"==a||"j1"==a)&&(a="nextGame"),("rg"==a||"j2"==a)&&(a="resetGame"),socket.emit("imageSendWithPassWord",{image:a,passWord:$("#inputArea").val()})}function sound(){var a=$("[name=musicFileName] option:selected").text();"アニキランダム"==a&&(a=anikiMusicFileName[Math.floor(Math.random()*anikiMusicFileName.length)]);var a=a.replace(".","\\.");$("#"+a).get(0).play()}function RewriteAndRead(){config.ctxForVideo.drawImage(video,0,0,config.canvasWidth,config.canvasHeight);var a=config.ctxForVideo.getImageData(0,0,config.canvasWidth,config.canvasHeight);lastCardPassedTimeSec+=.001*readQRCodeIntervalTimeMSec,lastCardPassedTimeSec>=1&&(lastCardPassedTimeSec=0,setLastCard(""),lastCard="");try{var b=new com.google.zxing.qrcode.QRCodeReader,c=new RGBLuminanceSource(a.data,a.width,a.height),d=new com.google.zxing.BinaryBitmap(new com.google.zxing.common.HybridBinarizer(c)),e=b.decode1(d),f=e.get_text();""===lastCard||lastCard!==f?(setLastCard(f),lastCardPassedTimeSec=0,sound(),sendImage(f)):lastCard===f&&(lastCardPassedTimeSec=0)}catch(g){}setTimeout("RewriteAndRead()",readQRCodeIntervalTimeMSec)}function setLastCard(a){lastCard=a,$("#result").html(a)}function setColorAndFont(a,b){config.ctx.fillStyle=a,config.ctx.font="bold "+b+"px 'ITC HIGHLANDER'"}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL;var video=document.getElementById("myVideo"),localStream=null;navigator.getUserMedia({video:!0,audio:!1},function(a){video.src=window.URL.createObjectURL(a)},function(a){console.log(a)});var socket=io.connect("http://"+hostAddress+"/qrCodeReader"),config={canvasWidth:400,canvasHeight:300},lastCard="",lastCardPassedTimeSec=0,readQRCodeIntervalTimeMSec=50,anikiMusicFileName=["aniki1.wav","aniki2.mp3","aniki3.wav","aniki4.wav","aniki5.wav"];$(function(){var a=$("#canvasForVideo").get(0);config.ctxForVideo=a.getContext("2d"),RewriteAndRead()}),$("#changeReadQRCodeIntervalTimeMSec").change(function(){switch($(this).val()){case"標準":return void(readQRCodeIntervalTimeMSec=100);case"高速":return void(readQRCodeIntervalTimeMSec=50)}});